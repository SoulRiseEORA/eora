<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ… ë””ë²„ê¹…</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .debug-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        .debug-button:hover {
            background: #0056b3;
        }

        .debug-output {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            max-height: 400px;
            overflow-y: auto;
        }

        .chat-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div class="debug-container">
        <h1>ğŸ”§ ì±„íŒ… ë””ë²„ê¹… ë„êµ¬</h1>

        <div class="debug-section">
            <h3>1ï¸âƒ£ API í…ŒìŠ¤íŠ¸</h3>
            <button class="debug-button" onclick="testAPI()">API ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <button class="debug-button" onclick="testSessions()">ì„¸ì…˜ ëª©ë¡ í…ŒìŠ¤íŠ¸</button>
            <button class="debug-button" onclick="testMessages()">ë©”ì‹œì§€ ì¡°íšŒ í…ŒìŠ¤íŠ¸</button>
            <div id="api-output" class="debug-output"></div>
        </div>

        <div class="debug-section">
            <h3>2ï¸âƒ£ ì‹¤ì œ ì±„íŒ… í˜ì´ì§€</h3>
            <button class="debug-button" onclick="openChatPage()">ì±„íŒ… í˜ì´ì§€ ì—´ê¸°</button>
            <button class="debug-button" onclick="reloadChatPage()">ì±„íŒ… í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
            <div id="chat-iframe-container">
                <iframe id="chat-iframe" class="chat-iframe" src="http://127.0.0.1:8001/chat"></iframe>
            </div>
        </div>

        <div class="debug-section">
            <h3>3ï¸âƒ£ ë””ë²„ê¹… ì •ë³´</h3>
            <button class="debug-button" onclick="checkConsole()">ì½˜ì†” ë¡œê·¸ í™•ì¸</button>
            <button class="debug-button" onclick="clearOutput()">ì¶œë ¥ ì§€ìš°ê¸°</button>
            <div id="debug-output" class="debug-output"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://127.0.0.1:8001';

        function log(message, type = 'info') {
            const output = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('debug-output').textContent = '';
            document.getElementById('api-output').textContent = '';
        }

        async function testAPI() {
            log('ğŸ” API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            try {
                const response = await fetch(`${BASE_URL}/api/sessions`);
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… API ì—°ê²° ì„±ê³µ - ì„¸ì…˜ ìˆ˜: ${data.sessions?.length || 0}`);
                    document.getElementById('api-output').textContent = JSON.stringify(data, null, 2);
                } else {
                    log(`âŒ API ì—°ê²° ì‹¤íŒ¨ - ìƒíƒœ: ${response.status}`);
                }
            } catch (error) {
                log(`ğŸ’¥ API ì—°ê²° ì˜¤ë¥˜: ${error.message}`);
            }
        }

        async function testSessions() {
            log('ğŸ” ì„¸ì…˜ ëª©ë¡ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            try {
                const response = await fetch(`${BASE_URL}/api/sessions`);
                const data = await response.json();

                if (response.ok) {
                    const sessions = data.sessions || [];
                    log(`âœ… ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ ì„±ê³µ - ${sessions.length}ê°œ ì„¸ì…˜`);

                    sessions.forEach((session, index) => {
                        log(`  ${index + 1}. ${session.name} (${session.id})`);
                    });

                    if (sessions.length > 0) {
                        // ì²« ë²ˆì§¸ ì„¸ì…˜ì˜ ë©”ì‹œì§€ë„ í…ŒìŠ¤íŠ¸
                        await testMessages(sessions[0].id);
                    }
                } else {
                    log(`âŒ ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${response.status}`);
                }
            } catch (error) {
                log(`ğŸ’¥ ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        async function testMessages(sessionId = null) {
            if (!sessionId) {
                log('âŒ ì„¸ì…˜ IDê°€ í•„ìš”í•©ë‹ˆë‹¤. ë¨¼ì € ì„¸ì…˜ ëª©ë¡ì„ ì¡°íšŒí•˜ì„¸ìš”.');
                return;
            }

            log(`ğŸ” ë©”ì‹œì§€ ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì‹œì‘ - ì„¸ì…˜: ${sessionId}`);

            try {
                const response = await fetch(`${BASE_URL}/api/sessions/${sessionId}/messages`);
                const data = await response.json();

                if (response.ok) {
                    const messages = data.messages || [];
                    log(`âœ… ë©”ì‹œì§€ ì¡°íšŒ ì„±ê³µ - ${messages.length}ê°œ ë©”ì‹œì§€`);

                    messages.forEach((msg, index) => {
                        log(`  ${index + 1}. [${msg.role}] ${msg.content.substring(0, 50)}...`);
                    });
                } else {
                    log(`âŒ ë©”ì‹œì§€ ì¡°íšŒ ì‹¤íŒ¨: ${response.status}`);
                }
            } catch (error) {
                log(`ğŸ’¥ ë©”ì‹œì§€ ì¡°íšŒ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        function openChatPage() {
            log('ğŸ”— ì±„íŒ… í˜ì´ì§€ ì—´ê¸°...');
            window.open('http://127.0.0.1:8001/chat', '_blank');
        }

        function reloadChatPage() {
            log('ğŸ”„ ì±„íŒ… í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨...');
            const iframe = document.getElementById('chat-iframe');
            iframe.src = iframe.src;
        }

        function checkConsole() {
            log('ğŸ” ì±„íŒ… í˜ì´ì§€ ì½˜ì†” ë¡œê·¸ í™•ì¸...');
            log('ğŸ’¡ ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(F12)ë¥¼ ì—´ì–´ì„œ ì½˜ì†” íƒ­ì„ í™•ì¸í•˜ì„¸ìš”.');
            log('ğŸ’¡ ì±„íŒ… í˜ì´ì§€ì—ì„œ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:');
            log('  1. DOM ìš”ì†Œë“¤ì´ ì œëŒ€ë¡œ ë¡œë“œë˜ì—ˆëŠ”ì§€');
            log('  2. ì„¸ì…˜ ëª©ë¡ ë¡œë”©ì´ ì„±ê³µí–ˆëŠ”ì§€');
            log('  3. ë©”ì‹œì§€ ë¡œë”©ì´ ì„±ê³µí–ˆëŠ”ì§€');
            log('  4. ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', () => {
            log('ğŸš€ ë””ë²„ê¹… ë„êµ¬ ë¡œë“œ ì™„ë£Œ');
            log('ğŸ’¡ "API ì—°ê²° í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        });
    </script>
</body>

</html>