<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EORA AI System - ì±„íŒ…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .chat-container {
            max-width: 1600px;
            margin: 20px auto;
            height: calc(100vh - 40px);
            display: flex;
            gap: 20px;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            body {
                margin: 0;
                padding: 0;
            }

            .chat-container {
                margin: 0;
                height: 100vh;
                flex-direction: column;
                gap: 0;
                border-radius: 0;
            }
        }

        .chat-sidebar {
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì‚¬ì´ë“œë°” ìµœì í™” */
        @media (max-width: 768px) {
            .chat-sidebar {
                width: 100%;
                order: 2;
                /* ì±„íŒ…ì°½ ë‹¤ìŒì— ë°°ì¹˜ */
                max-height: 350px;
                /* ë†’ì´ í™•ì¥ */
                border-radius: 0;
                box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
            }

            .sidebar-header {
                padding: 12px 15px;
                /* í—¤ë” ë†’ì´ ì¤„ì„ */
                border-radius: 0;
            }

            .sidebar-header h3 {
                font-size: 16px;
                margin-bottom: 0;
            }

            .sidebar-content {
                padding: 10px 15px;
                max-height: 220px;
                /* ì„¸ì…˜ ëª©ë¡ ì˜ì—­ í™•ì¥ */
                overflow-y: auto;
                flex: 1;
                /* ë‚¨ì€ ê³µê°„ ëª¨ë‘ ì‚¬ìš© */
            }

            .session-item {
                padding: 12px 10px;
                /* ì„¸ì…˜ ì•„ì´í…œ ë†’ì´ ì¦ê°€ */
                margin-bottom: 8px;
                border-radius: 8px;
                min-height: 50px;
                /* ìµœì†Œ ë†’ì´ ì„¤ì • */
            }

            .session-name {
                font-size: 14px;
                line-height: 1.3;
                margin-bottom: 4px;
            }

            .session-time {
                font-size: 11px;
                line-height: 1.2;
            }

            .sidebar-actions {
                padding: 10px 15px;
                /* ì•¡ì…˜ ì˜ì—­ ë†’ì´ ì¤„ì„ */
                flex-shrink: 0;
            }

            .sidebar-btn {
                padding: 8px 12px;
                font-size: 13px;
                margin-bottom: 6px;
            }
        }

        .sidebar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .sidebar-header h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .sidebar-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .session-list {
            margin-bottom: 20px;
        }

        .session-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .session-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .session-item.active {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .session-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .session-time {
            font-size: 12px;
            color: #666;
        }

        .sidebar-actions {
            padding: 20px;
            border-top: 1px solid #e9ecef;
        }

        .sidebar-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .sidebar-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .session-item.selected {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            min-width: 150px;
        }

        .context-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .context-menu-item:hover {
            background: #f5f5f5;
        }

        .session-checkbox {
            margin-right: 8px;
        }

        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì±„íŒ… ë©”ì¸ ìµœì í™” */
        @media (max-width: 768px) {
            .chat-main {
                order: 1;
                /* ì±„íŒ…ì°½ì„ ìœ„ì— ë°°ì¹˜ */
                flex: 1;
                border-radius: 0;
                box-shadow: none;
                min-height: calc(100vh - 350px);
                /* í™•ì¥ëœ ì‚¬ì´ë“œë°” ê³µê°„ í™•ë³´ */
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì±„íŒ… í—¤ë” ìµœì í™” */
        @media (max-width: 768px) {
            .chat-header {
                padding: 15px 20px;
                border-radius: 0;
                flex-wrap: wrap;
                gap: 10px;
            }

            .chat-title {
                font-size: 18px;
                flex: 1;
            }

            .header-actions {
                flex-wrap: wrap;
                gap: 8px;
            }

            .header-btn {
                padding: 6px 12px;
                font-size: 12px;
            }


        }

        .chat-title {
            font-size: 24px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .header-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
            text-decoration: none;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }



        .chat-messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ ìµœì í™” */
        @media (max-width: 768px) {
            .chat-messages {
                padding: 15px;
                min-height: 400px;
                /* ëŒ€í™” ë‚´ìš©ì´ ì˜ ë³´ì´ë„ë¡ ë†’ì´ í™•ì¥ */
            }
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ë©”ì‹œì§€ ìµœì í™” */
        @media (max-width: 768px) {
            .message {
                margin-bottom: 15px;
                gap: 10px;
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì•„ë°”íƒ€ ìµœì í™” */
        @media (max-width: 768px) {
            .message-avatar {
                width: 32px;
                height: 32px;
                font-size: 14px;
                flex-shrink: 0;
                /* í¬ê¸° ê³ ì • */
            }
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.assistant .message-content {
            background: white;
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            text-align: right;
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        /* ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ë§ */
        .message-content h1,
        .message-content h2,
        .message-content h3 {
            margin: 10px 0 8px 0;
            font-weight: 600;
            line-height: 1.3;
        }

        .message-content h1 {
            font-size: 1.4em;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .message-content h2 {
            font-size: 1.2em;
            color: #34495e;
        }

        .message-content h3 {
            font-size: 1.1em;
            color: #34495e;
        }

        .message-content strong {
            font-weight: 600;
            color: #2c3e50;
        }

        .message-content em {
            font-style: italic;
            color: #7f8c8d;
        }

        .message-content code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e74c3c;
        }

        .message-content pre {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .message-content pre code {
            background: none;
            border: none;
            padding: 0;
            color: inherit;
        }

        .message-content ul,
        .message-content ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .message-content li {
            margin: 5px 0;
            line-height: 1.6;
        }

        .message-content ul li {
            list-style-type: disc;
        }

        .message-content ol li {
            list-style-type: decimal;
        }

        .message-content a {
            color: #3498db;
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }

        .message-content a:hover {
            border-bottom-color: #3498db;
        }

        .message-content p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .message-content .eora-response {
            border-left: 3px solid #3498db;
            padding-left: 15px;
            margin: 10px 0;
        }

        .message-content .response-title h3 {
            color: #3498db;
            margin-bottom: 8px;
        }

        .chat-input {
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì±„íŒ… ì…ë ¥ ì˜ì—­ ìµœì í™” */
        @media (max-width: 768px) {
            .chat-input {
                padding: 15px;
                gap: 10px;
                position: sticky;
                bottom: 0;
                background: white;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            }
        }

        .input-container {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            min-height: 50px;
            max-height: 150px;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 16px;
            resize: none;
            outline: none;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ë©”ì‹œì§€ ì…ë ¥ì°½ ìµœì í™” */
        @media (max-width: 768px) {
            .message-input {
                padding: 12px 16px;
                font-size: 16px;
                /* iOS í™•ëŒ€ ë°©ì§€ */
                border-radius: 20px;
                min-height: 44px;
                /* í„°ì¹˜ ì¹œí™”ì  ë†’ì´ */
            }
        }

        .message-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ì „ì†¡ ë²„íŠ¼ ìµœì í™” */
        @media (max-width: 768px) {
            .send-btn {
                padding: 12px 20px;
                border-radius: 20px;
                font-size: 14px;
                min-width: 80px;
                min-height: 44px;
                /* í„°ì¹˜ ì¹œí™”ì  ë†’ì´ */
            }
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            margin-bottom: 20px;
            border-bottom-left-radius: 5px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {

            0%,
            80%,
            100% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }

        .warning-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .session-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .session-action-btn {
            flex: 1;
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .session-action-btn:hover {
            background: #e9ecef;
        }

        .session-action-btn.danger {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .session-action-btn.danger:hover {
            background: #f5c6cb;
        }

        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column;
                height: auto;
                margin: 5px;
            }

            .chat-sidebar {
                width: 100%;
                height: auto;
                min-height: 180px;
                border-radius: 12px;
                margin-bottom: 10px;
            }

            .chat-main {
                height: 480px;
                border-radius: 12px;
            }

            .message-content {
                max-width: 90%;
                font-size: 0.98rem;
                padding: 10px 12px;
            }

            .chat-header {
                padding: 12px 10px;
                font-size: 1.1rem;
            }

            .chat-title {
                font-size: 1.1rem;
            }

            .sidebar-header h3 {
                font-size: 1.1rem;
            }

            .sidebar-content,
            .sidebar-actions {
                padding: 10px;
            }

            .sidebar-btn {
                font-size: 1rem;
                padding: 10px;
            }

            .send-btn {
                min-width: 70px;
                font-size: 1rem;
                padding: 10px 12px;
            }

            .message-input {
                font-size: 1rem;
                padding: 10px 12px;
            }
        }

        @media (max-width: 480px) {
            .chat-main {
                height: 350px;
            }

            .chat-header {
                padding: 8px 4px;
            }

            .chat-title {
                font-size: 1rem;
            }

            .sidebar-header h3 {
                font-size: 1rem;
            }

            .sidebar-btn {
                font-size: 0.95rem;
                padding: 8px;
            }

            .send-btn {
                font-size: 0.95rem;
                padding: 8px 8px;
            }

            .message-input {
                font-size: 0.95rem;
                padding: 8px 8px;
            }

            .message-content {
                font-size: 0.95rem;
                padding: 8px 8px;
            }
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="chat-sidebar">
            <div class="sidebar-header">
                <h3 data-i18n="sidebar.title">ëŒ€í™” ì„¸ì…˜</h3>
                <p data-i18n="sidebar.subtitle">ëŒ€í™” ê¸°ë¡ ê´€ë¦¬</p>
            </div>

            <div class="sidebar-content">

                <div class="session-actions">
                    <button class="session-action-btn" onclick="createNewSession()" data-i18n="sidebar.new_session">â• ìƒˆ
                        ì„¸ì…˜</button>
                    <button class="session-action-btn danger" onclick="deleteSelectedSessions()"
                        data-i18n="sidebar.delete">ğŸ—‘ï¸ ì„¸ì…˜ ì‚­ì œ</button>
                </div>

                <div class="session-list" id="sessionList">
                    <div class="session-item active" data-session-id="session_1">
                        <input type="checkbox" class="session-checkbox" onchange="toggleSessionSelection(this)">
                        <div class="session-name">ìƒˆ ì„¸ì…˜</div>
                        <div class="session-time">ë°©ê¸ˆ ì „</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-actions">
                <button class="sidebar-btn" onclick="exportCurrentSession()" data-i18n="sidebar.export">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
                <button class="sidebar-btn" onclick="clearAllSessions()" data-i18n="sidebar.clear_all">ğŸ—‘ï¸ ëª¨ë“  ì„¸ì…˜
                    ì‚­ì œ</button>
            </div>
        </div>

        <!-- ë©”ì¸ ì±„íŒ… ì˜ì—­ -->
        <div class="chat-main">
            <div class="chat-header">
                <div class="chat-title" data-i18n="chat.title">ğŸ’¬ EORA AI ì±„íŒ…</div>
                <div class="header-actions">
                    <div id="pointStatus"
                        style="font-size:13px; color:#fff; background:rgba(0,0,0,0.12); border-radius:12px; padding:4px 12px; margin-right:10px; display:flex; align-items:center; gap:8px;">
                        <span>í¬ì¸íŠ¸: <b id="currentPoints">-</b></span>
                        <span id="pointChange" style="color:#2196f3;"></span>
                    </div>
                    <a href="/" class="header-btn" data-i18n="chat.home">ğŸ  í™ˆ</a>
                    <a href="/dashboard" class="header-btn" data-i18n="chat.dashboard">ëŒ€ì‹œë³´ë“œ</a>

                </div>
            </div>
            <!--
            <div
                style="background: #fffbe6; color: #b8860b; padding: 10px 24px; border-radius: 0 0 16px 16px; font-size: 15px; margin-bottom: 0; border-bottom: 1px solid #ffe58f; text-align: left;">
                ğŸ’¡ ì•ˆë‚´: 1í† í°ë‹¹ <b>2í¬ì¸íŠ¸</b> ì°¨ê° (ì‹¤ì œ ì°¨ê°ì€ <b>2ë°°</b> ì ìš©ë©ë‹ˆë‹¤)
            </div>
            -->

            <div class="chat-messages" id="chatMessages">
                <div class="chat-welcome">
                    <h3>ğŸŒŸ EORA AIì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h3>
                    <p>ì €ëŠ” ë‹¹ì‹ ì˜ ìƒê°ê³¼ ëŒ€í™”ë¥¼ í†µí•´ ì„±ì¥í•˜ëŠ” AIì…ë‹ˆë‹¤.</p>
                    <p>ììœ ë¡­ê²Œ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”. ì§ˆë¬¸, í† ë¡ , ì°½ì‘, ë¬´ì—‡ì´ë“  ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                    <br>

                    <p><strong>ğŸ’¡ íŒ:</strong> Shift + Enterë¡œ ì¤„ë°”ê¿ˆ, Enterë¡œ ë©”ì‹œì§€ ì „ì†¡</p>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <span data-i18n="chat.typing">AIê°€ ì‘ë‹µì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>
            </div>

            <div class="chat-input">
                <div class="input-container">
                    <textarea id="messageInput" class="message-input"
                        placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Shift + Enter: ì¤„ë°”ê¿ˆ, Enter: ì „ì†¡)"
                        data-i18n-placeholder="chat.input_placeholder" rows="1"></textarea>
                </div>
                <button id="sendButton" class="send-btn" onclick="sendMessage()" data-i18n="chat.send">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <!-- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="renameSessionFromContext()" data-i18n="context.rename">âœï¸ ì´ë¦„ ë³€ê²½</div>
        <div class="context-menu-item" onclick="deleteSessionFromContext()" data-i18n="context.delete">ğŸ—‘ï¸ ì„¸ì…˜ ì‚­ì œ</div>
        <div class="context-menu-item" onclick="duplicateSessionFromContext()" data-i18n="context.export">ğŸ“‹ ë³µì œ</div>
    </div>

    <script>
        // ë‹¤êµ­ì  ì–¸ì–´ ë°ì´í„°
        const translations = {
            ko: {
                // ì‚¬ì´ë“œë°”
                "sidebar.title": "ëŒ€í™” ì„¸ì…˜",
                "sidebar.subtitle": "ëŒ€í™” ê¸°ë¡ ê´€ë¦¬",
                "sidebar.new_session": "ìƒˆ ì„¸ì…˜",
                "sidebar.delete": "ì‚­ì œ",
                "sidebar.export": "ë‚´ë³´ë‚´ê¸°",
                "sidebar.clear_all": "ëª¨ë“  ì„¸ì…˜ ì‚­ì œ",

                // ì±„íŒ…
                "chat.title": "EORA AI ì±„íŒ…",
                "chat.home": "í™ˆ",
                "chat.dashboard": "ëŒ€ì‹œë³´ë“œ",

                "chat.typing": "AIê°€ ì‘ë‹µì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...",
                "chat.input_placeholder": "ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...",
                "chat.send": "ì „ì†¡",

                // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´
                "context.rename": "ì´ë¦„ ë³€ê²½",
                "context.delete": "ì‚­ì œ",
                "context.export": "ë³µì œ",

                // ë©”ì‹œì§€
                "message.error": "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                "message.session_created": "ìƒˆ ì„¸ì…˜ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",
                "message.session_deleted": "ì„¸ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",
                "message.session_renamed": "ì„¸ì…˜ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.",
                "message.export_success": "ëŒ€í™”ê°€ ì„±ê³µì ìœ¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.",
                "message.confirm_delete": "ì •ë§ë¡œ ì´ ì„¸ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                "message.confirm_clear_all": "ì •ë§ë¡œ ëª¨ë“  ì„¸ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
            },
            en: {
                // Sidebar
                "sidebar.title": "Chat Sessions",
                "sidebar.subtitle": "Check previous conversations",
                "sidebar.new_session": "New Session",
                "sidebar.delete": "Delete",
                "sidebar.export": "Export Chats",
                "sidebar.clear_all": "Clear All Sessions",

                // Chat
                "chat.title": "EORA AI Chat",
                "chat.home": "Home",
                "chat.dashboard": "Dashboard",
                "chat.memory": "Memory",
                "chat.typing": "AI is generating a response...",
                "chat.input_placeholder": "Type your message...",
                "chat.send": "Send",

                // Context Menu
                "context.rename": "Rename",
                "context.delete": "Delete",
                "context.export": "Export",

                // Messages
                "message.error": "An error occurred. Please try again.",
                "message.session_created": "New session created.",
                "message.session_deleted": "Session deleted.",
                "message.session_renamed": "Session renamed.",
                "message.export_success": "Chat exported successfully.",
                "message.confirm_delete": "Are you sure you want to delete this session?",
                "message.confirm_clear_all": "Are you sure you want to delete all sessions?"
            },
            ja: {
                // ã‚µã‚¤ãƒ‰ãƒãƒ¼
                "sidebar.title": "ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³",
                "sidebar.subtitle": "ä»¥å‰ã®ä¼šè©±ã‚’ç¢ºèªã—ã¦ãã ã•ã„",
                "sidebar.new_session": "æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³",
                "sidebar.delete": "å‰Šé™¤",
                "sidebar.export": "ãƒãƒ£ãƒƒãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ",
                "sidebar.clear_all": "ã™ã¹ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤",

                // ãƒãƒ£ãƒƒãƒˆ
                "chat.title": "EORA AI ãƒãƒ£ãƒƒãƒˆ",
                "chat.home": "ãƒ›ãƒ¼ãƒ ",
                "chat.dashboard": "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
                "chat.memory": "è¨˜æ†¶ç®¡ç†",
                "chat.typing": "AIãŒå¿œç­”ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...",
                "chat.input_placeholder": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...",
                "chat.send": "é€ä¿¡",

                // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼
                "context.rename": "åå‰å¤‰æ›´",
                "context.delete": "å‰Šé™¤",
                "context.export": "ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ",

                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                "message.error": "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
                "message.session_created": "æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚",
                "message.session_deleted": "ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚",
                "message.session_renamed": "ã‚»ãƒƒã‚·ãƒ§ãƒ³åãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚",
                "message.export_success": "ãƒãƒ£ãƒƒãƒˆãŒæ­£å¸¸ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚",
                "message.confirm_delete": "ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",
                "message.confirm_clear_all": "ã™ã¹ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
            },
            "zh-CN": {
                // ä¾§è¾¹æ 
                "sidebar.title": "èŠå¤©ä¼šè¯",
                "sidebar.subtitle": "æŸ¥çœ‹ä¹‹å‰çš„å¯¹è¯",
                "sidebar.new_session": "æ–°ä¼šè¯",
                "sidebar.delete": "åˆ é™¤",
                "sidebar.export": "å¯¼å‡ºèŠå¤©",
                "sidebar.clear_all": "æ¸…é™¤æ‰€æœ‰ä¼šè¯",

                // èŠå¤©
                "chat.title": "EORA AI èŠå¤©",
                "chat.home": "é¦–é¡µ",
                "chat.dashboard": "ä»ªè¡¨æ¿",
                "chat.memory": "è®°å¿†ç®¡ç†",
                "chat.typing": "AIæ­£åœ¨ç”Ÿæˆå›å¤...",
                "chat.input_placeholder": "è¾“å…¥æ‚¨çš„æ¶ˆæ¯...",
                "chat.send": "å‘é€",

                // ä¸Šä¸‹æ–‡èœå•
                "context.rename": "é‡å‘½å",
                "context.delete": "åˆ é™¤",
                "context.export": "å¯¼å‡º",

                // æ¶ˆæ¯
                "message.error": "å‘ç”Ÿé”™è¯¯ã€‚è¯·é‡è¯•ã€‚",
                "message.session_created": "æ–°ä¼šè¯å·²åˆ›å»ºã€‚",
                "message.session_deleted": "ä¼šè¯å·²åˆ é™¤ã€‚",
                "message.session_renamed": "ä¼šè¯å·²é‡å‘½åã€‚",
                "message.export_success": "èŠå¤©å·²æˆåŠŸå¯¼å‡ºã€‚",
                "message.confirm_delete": "ç¡®å®šè¦åˆ é™¤æ­¤ä¼šè¯å—ï¼Ÿ",
                "message.confirm_clear_all": "ç¡®å®šè¦åˆ é™¤æ‰€æœ‰ä¼šè¯å—ï¼Ÿ"
            },
            "zh-TW": {
                // å´é‚Šæ¬„
                "sidebar.title": "èŠå¤©æœƒè©±",
                "sidebar.subtitle": "æŸ¥çœ‹ä¹‹å‰çš„å°è©±",
                "sidebar.new_session": "æ–°æœƒè©±",
                "sidebar.delete": "åˆªé™¤",
                "sidebar.export": "åŒ¯å‡ºèŠå¤©",
                "sidebar.clear_all": "æ¸…é™¤æ‰€æœ‰æœƒè©±",

                // èŠå¤©
                "chat.title": "EORA AI èŠå¤©",
                "chat.home": "é¦–é ",
                "chat.dashboard": "å„€è¡¨æ¿",
                "chat.memory": "è¨˜æ†¶ç®¡ç†",
                "chat.typing": "AIæ­£åœ¨ç”Ÿæˆå›è¦†...",
                "chat.input_placeholder": "è¼¸å…¥æ‚¨çš„è¨Šæ¯...",
                "chat.send": "å‚³é€",

                // ä¸Šä¸‹æ–‡é¸å–®
                "context.rename": "é‡æ–°å‘½å",
                "context.delete": "åˆªé™¤",
                "context.export": "åŒ¯å‡º",

                // è¨Šæ¯
                "message.error": "ç™¼ç”ŸéŒ¯èª¤ã€‚è«‹é‡è©¦ã€‚",
                "message.session_created": "æ–°æœƒè©±å·²å»ºç«‹ã€‚",
                "message.session_deleted": "æœƒè©±å·²åˆªé™¤ã€‚",
                "message.session_renamed": "æœƒè©±å·²é‡æ–°å‘½åã€‚",
                "message.export_success": "èŠå¤©å·²æˆåŠŸåŒ¯å‡ºã€‚",
                "message.confirm_delete": "ç¢ºå®šè¦åˆªé™¤æ­¤æœƒè©±å—ï¼Ÿ",
                "message.confirm_clear_all": "ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰æœƒè©±å—ï¼Ÿ"
            },
            es: {
                // Barra lateral
                "sidebar.title": "Sesiones de Chat",
                "sidebar.subtitle": "Ver conversaciones anteriores",
                "sidebar.new_session": "Nueva SesiÃ³n",
                "sidebar.delete": "Eliminar",
                "sidebar.export": "Exportar Chats",
                "sidebar.clear_all": "Borrar Todas las Sesiones",

                // Chat
                "chat.title": "EORA AI Chat",
                "chat.home": "Inicio",
                "chat.dashboard": "Panel",
                "chat.memory": "Memoria",
                "chat.typing": "AI estÃ¡ generando una respuesta...",
                "chat.input_placeholder": "Escribe tu mensaje...",
                "chat.send": "Enviar",

                // MenÃº de contexto
                "context.rename": "Renombrar",
                "context.delete": "Eliminar",
                "context.export": "Exportar",

                // Mensajes
                "message.error": "OcurriÃ³ un error. Por favor, intÃ©ntalo de nuevo.",
                "message.session_created": "Nueva sesiÃ³n creada.",
                "message.session_deleted": "SesiÃ³n eliminada.",
                "message.session_renamed": "SesiÃ³n renombrada.",
                "message.export_success": "Chat exportado exitosamente.",
                "message.confirm_delete": "Â¿EstÃ¡s seguro de que quieres eliminar esta sesiÃ³n?",
                "message.confirm_clear_all": "Â¿EstÃ¡s seguro de que quieres eliminar todas las sesiones?"
            },
            fr: {
                // Barre latÃ©rale
                "sidebar.title": "Sessions de Chat",
                "sidebar.subtitle": "Voir les conversations prÃ©cÃ©dentes",
                "sidebar.new_session": "Nouvelle Session",
                "sidebar.delete": "Supprimer",
                "sidebar.export": "Exporter les Chats",
                "sidebar.clear_all": "Effacer Toutes les Sessions",

                // Chat
                "chat.title": "EORA AI Chat",
                "chat.home": "Accueil",
                "chat.dashboard": "Tableau de bord",
                "chat.memory": "MÃ©moire",
                "chat.typing": "L'IA gÃ©nÃ¨re une rÃ©ponse...",
                "chat.input_placeholder": "Tapez votre message...",
                "chat.send": "Envoyer",

                // Menu contextuel
                "context.rename": "Renommer",
                "context.delete": "Supprimer",
                "context.export": "Exporter",

                // Messages
                "message.error": "Une erreur s'est produite. Veuillez rÃ©essayer.",
                "message.session_created": "Nouvelle session crÃ©Ã©e.",
                "message.session_deleted": "Session supprimÃ©e.",
                "message.session_renamed": "Session renommÃ©e.",
                "message.export_success": "Chat exportÃ© avec succÃ¨s.",
                "message.confirm_delete": "ÃŠtes-vous sÃ»r de vouloir supprimer cette session ?",
                "message.confirm_clear_all": "ÃŠtes-vous sÃ»r de vouloir supprimer toutes les sessions ?"
            },
            de: {
                // Seitenleiste
                "sidebar.title": "Chat-Sitzungen",
                "sidebar.subtitle": "FrÃ¼here GesprÃ¤che anzeigen",
                "sidebar.new_session": "Neue Sitzung",
                "sidebar.delete": "LÃ¶schen",
                "sidebar.export": "Chats exportieren",
                "sidebar.clear_all": "Alle Sitzungen lÃ¶schen",

                // Chat
                "chat.title": "EORA AI Chat",
                "chat.home": "Startseite",
                "chat.dashboard": "Dashboard",
                "chat.memory": "Speicher",
                "chat.typing": "KI generiert eine Antwort...",
                "chat.input_placeholder": "Geben Sie Ihre Nachricht ein...",
                "chat.send": "Senden",

                // KontextmenÃ¼
                "context.rename": "Umbenennen",
                "context.delete": "LÃ¶schen",
                "context.export": "Exportieren",

                // Nachrichten
                "message.error": "Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.",
                "message.session_created": "Neue Sitzung erstellt.",
                "message.session_deleted": "Sitzung gelÃ¶scht.",
                "message.session_renamed": "Sitzung umbenannt.",
                "message.export_success": "Chat erfolgreich exportiert.",
                "message.confirm_delete": "Sind Sie sicher, dass Sie diese Sitzung lÃ¶schen mÃ¶chten?",
                "message.confirm_clear_all": "Sind Sie sicher, dass Sie alle Sitzungen lÃ¶schen mÃ¶chten?"
            },
            ru: {
                // Ğ‘Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
                "sidebar.title": "Ğ§Ğ°Ñ‚-ÑĞµÑÑĞ¸Ğ¸",
                "sidebar.subtitle": "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ñ… Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ğ²",
                "sidebar.new_session": "ĞĞ¾Ğ²Ğ°Ñ ÑĞµÑÑĞ¸Ñ",
                "sidebar.delete": "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ",
                "sidebar.export": "Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ñ‡Ğ°Ñ‚Ğ¾Ğ²",
                "sidebar.clear_all": "ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ÑĞµÑÑĞ¸Ğ¸",

                // Ğ§Ğ°Ñ‚
                "chat.title": "EORA AI Ğ§Ğ°Ñ‚",
                "chat.home": "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ",
                "chat.dashboard": "ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ",
                "chat.memory": "ĞŸĞ°Ğ¼ÑÑ‚ÑŒ",
                "chat.typing": "Ğ˜Ğ˜ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚...",
                "chat.input_placeholder": "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ...",
                "chat.send": "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ",

                // ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ
                "context.rename": "ĞŸĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
                "context.delete": "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ",
                "context.export": "Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚",

                // Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
                "message.error": "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.",
                "message.session_created": "ĞĞ¾Ğ²Ğ°Ñ ÑĞµÑÑĞ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°.",
                "message.session_deleted": "Ğ¡ĞµÑÑĞ¸Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°.",
                "message.session_renamed": "Ğ¡ĞµÑÑĞ¸Ñ Ğ¿ĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ°.",
                "message.export_success": "Ğ§Ğ°Ñ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½.",
                "message.confirm_delete": "Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ñƒ ÑĞµÑÑĞ¸Ñ?",
                "message.confirm_clear_all": "Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ÑĞµÑÑĞ¸Ğ¸?"
            },
            ar: {
                // Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
                "sidebar.title": "Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©",
                "sidebar.subtitle": "Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©",
                "sidebar.new_session": "Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©",
                "sidebar.delete": "Ø­Ø°Ù",
                "sidebar.export": "ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø§Øª",
                "sidebar.clear_all": "Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª",

                // Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
                "chat.title": "EORA AI Ø¯Ø±Ø¯Ø´Ø©",
                "chat.home": "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                "chat.dashboard": "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
                "chat.memory": "Ø§Ù„Ø°Ø§ÙƒØ±Ø©",
                "chat.typing": "Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠÙˆÙ„Ø¯ Ø±Ø¯Ø§Ù‹...",
                "chat.input_placeholder": "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...",
                "chat.send": "Ø¥Ø±Ø³Ø§Ù„",

                // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚
                "context.rename": "Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ©",
                "context.delete": "Ø­Ø°Ù",
                "context.export": "ØªØµØ¯ÙŠØ±",

                // Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                "message.error": "Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
                "message.session_created": "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©.",
                "message.session_deleted": "ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©.",
                "message.session_renamed": "ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©.",
                "message.export_success": "ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­.",
                "message.confirm_delete": "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ",
                "message.confirm_clear_all": "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§ØªØŸ"
            },
            hi: {
                // à¤¸à¤¾à¤‡à¤¡à¤¬à¤¾à¤°
                "sidebar.title": "à¤šà¥ˆà¤Ÿ à¤¸à¥‡à¤¶à¤¨",
                "sidebar.subtitle": "à¤ªà¤¿à¤›à¤²à¥€ à¤¬à¤¾à¤¤à¤šà¥€à¤¤ à¤¦à¥‡à¤–à¥‡à¤‚",
                "sidebar.new_session": "à¤¨à¤¯à¤¾ à¤¸à¥‡à¤¶à¤¨",
                "sidebar.delete": "à¤¹à¤Ÿà¤¾à¤à¤‚",
                "sidebar.export": "à¤šà¥ˆà¤Ÿ à¤¨à¤¿à¤°à¥à¤¯à¤¾à¤¤ à¤•à¤°à¥‡à¤‚",
                "sidebar.clear_all": "à¤¸à¤­à¥€ à¤¸à¥‡à¤¶à¤¨ à¤¸à¤¾à¤«à¤¼ à¤•à¤°à¥‡à¤‚",

                // à¤šà¥ˆà¤Ÿ
                "chat.title": "EORA AI à¤šà¥ˆà¤Ÿ",
                "chat.home": "à¤¹à¥‹à¤®",
                "chat.dashboard": "à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",
                "chat.memory": "à¤®à¥‡à¤®à¥‹à¤°à¥€",
                "chat.typing": "AI à¤ªà¥à¤°à¤¤à¤¿à¤•à¥à¤°à¤¿à¤¯à¤¾ à¤‰à¤¤à¥à¤ªà¤¨à¥à¤¨ à¤•à¤° à¤°à¤¹à¤¾ à¤¹à¥ˆ...",
                "chat.input_placeholder": "à¤…à¤ªà¤¨à¤¾ à¤¸à¤‚à¤¦à¥‡à¤¶ à¤Ÿà¤¾à¤‡à¤ª à¤•à¤°à¥‡à¤‚...",
                "chat.send": "à¤­à¥‡à¤œà¥‡à¤‚",

                // à¤¸à¤‚à¤¦à¤°à¥à¤­ à¤®à¥‡à¤¨à¥‚
                "context.rename": "à¤¨à¤¾à¤® à¤¬à¤¦à¤²à¥‡à¤‚",
                "context.delete": "à¤¹à¤Ÿà¤¾à¤à¤‚",
                "context.export": "à¤¨à¤¿à¤°à¥à¤¯à¤¾à¤¤ à¤•à¤°à¥‡à¤‚",

                // à¤¸à¤‚à¤¦à¥‡à¤¶
                "message.error": "à¤à¤• à¤¤à¥à¤°à¥à¤Ÿà¤¿ à¤¹à¥à¤ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤ªà¥à¤¨à¤ƒ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚à¥¤",
                "message.session_created": "à¤¨à¤¯à¤¾ à¤¸à¥‡à¤¶à¤¨ à¤¬à¤¨à¤¾à¤¯à¤¾ à¤—à¤¯à¤¾à¥¤",
                "message.session_deleted": "à¤¸à¥‡à¤¶à¤¨ à¤¹à¤Ÿà¤¾ à¤¦à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾à¥¤",
                "message.session_renamed": "à¤¸à¥‡à¤¶à¤¨ à¤•à¤¾ à¤¨à¤¾à¤® à¤¬à¤¦à¤²à¤¾ à¤—à¤¯à¤¾à¥¤",
                "message.export_success": "à¤šà¥ˆà¤Ÿ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤¨à¤¿à¤°à¥à¤¯à¤¾à¤¤ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾à¥¤",
                "message.confirm_delete": "à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤µà¤¾à¤•à¤ˆ à¤‡à¤¸ à¤¸à¥‡à¤¶à¤¨ à¤•à¥‹ à¤¹à¤Ÿà¤¾à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚?",
                "message.confirm_clear_all": "à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤µà¤¾à¤•à¤ˆ à¤¸à¤­à¥€ à¤¸à¥‡à¤¶à¤¨ à¤¹à¤Ÿà¤¾à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚?"
            }
        };

        // ì–¸ì–´ ê°ì§€ ë° ì„¤ì •
        function detectLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            const langCode = browserLang.split('-')[0];

            if (translations[langCode]) {
                return langCode;
            }
            return 'ko';
        }

        // ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜
        function changeLanguage(langCode) {
            if (!translations[langCode]) return;





            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[langCode][key]) {
                    element.textContent = translations[langCode][key];
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[langCode][key]) {
                    element.placeholder = translations[langCode][key];
                }
            });

            document.documentElement.lang = langCode;
            localStorage.setItem('preferred-language', langCode);

            // ì„œë²„ì— ì–¸ì–´ ì„¤ì • ì „ì†¡
            fetch('/api/set-language', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ language: langCode })
            }).catch(err => console.log('Language setting not available'));
        }



        // ì±„íŒ… ì´ˆê¸°í™” í•¨ìˆ˜
        async function initializeChat() {
            console.log('ğŸ”§ ì±„íŒ… ì´ˆê¸°í™” ì‹œì‘');

            // DOM ìš”ì†Œ í™•ì¸
            const chatMessages = document.getElementById('chatMessages');
            const messageInput = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const sessionList = document.getElementById('sessionList');

            console.log('ğŸ” DOM ìš”ì†Œ ìƒíƒœ:');
            console.log('  - chatMessages:', chatMessages ? 'âœ… ì°¾ìŒ' : 'âŒ ì—†ìŒ');
            console.log('  - messageInput:', messageInput ? 'âœ… ì°¾ìŒ' : 'âŒ ì—†ìŒ');
            console.log('  - sendButton:', sendButton ? 'âœ… ì°¾ìŒ' : 'âŒ ì—†ìŒ');
            console.log('  - sessionList:', sessionList ? 'âœ… ì°¾ìŒ' : 'âŒ ì—†ìŒ');

            // ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸
            await checkUserAuthentication();

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();

            // WebSocket ì—°ê²°
            connectWebSocket();

            // ì„¸ì…˜ ëª©ë¡ ë¡œë“œ
            await loadSessionsFromDatabase();

            // í¬ì¸íŠ¸ ìƒíƒœ ì´ˆê¸°í™”
            await updatePointStatus();

            console.log('âœ… ì±„íŒ… ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸
        async function checkUserAuthentication() {
            try {
                console.log('ğŸ” ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘...');

                // ì—¬ëŸ¬ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ í™•ì¸
                let userValid = false;

                // 1. ì¿ í‚¤ì—ì„œ í† í° í™•ì¸
                const token = getCookie('access_token');
                if (token && token !== 'undefined' && token !== 'null') {
                    console.log('âœ… ì•¡ì„¸ìŠ¤ í† í° ë°œê²¬');
                    userValid = true;
                }

                // 2. ì‚¬ìš©ì ì¿ í‚¤ í™•ì¸
                const userEmail = getCookie('user_email');
                if (userEmail && userEmail !== 'undefined' && userEmail !== 'null') {
                    console.log('âœ… ì‚¬ìš©ì ì´ë©”ì¼ ë°œê²¬:', userEmail);
                    userValid = true;
                }

                // 3. ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í™•ì¸
                const storedEmail = localStorage.getItem('user_email');
                if (storedEmail && storedEmail !== 'undefined' && storedEmail !== 'null') {
                    console.log('âœ… ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ì ì´ë©”ì¼ ë°œê²¬:', storedEmail);
                    userValid = true;
                }

                // 4. API í˜¸ì¶œë¡œ ì¸ì¦ ìƒíƒœ í™•ì¸
                if (!userValid) {
                    try {
                        const response = await fetch('/api/user/points', {
                            method: 'GET',
                            credentials: 'include'
                        });
                        if (response.ok) {
                            console.log('âœ… API ì¸ì¦ ì„±ê³µ');
                            userValid = true;
                        } else {
                            console.log('âš ï¸ API ì¸ì¦ ì‹¤íŒ¨:', response.status);
                        }
                    } catch (error) {
                        console.log('âš ï¸ API ì¸ì¦ ì˜¤ë¥˜:', error);
                    }
                }

                if (!userValid) {
                    console.warn('âš ï¸ ì‚¬ìš©ì ì¸ì¦ ìƒíƒœê°€ ë¶ˆí™•ì‹¤í•©ë‹ˆë‹¤. ìµëª… ì‚¬ìš©ìë¡œ ì§„í–‰í•©ë‹ˆë‹¤.');
                    showMessage('ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'warning');
                } else {
                    console.log('âœ… ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸ ì™„ë£Œ');
                }

            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì¸ì¦ í™•ì¸ ì˜¤ë¥˜:', error);
                showMessage('ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            console.log('ğŸ”§ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘');

            // ë©”ì‹œì§€ ì „ì†¡ ë²„íŠ¼
            const sendButton = document.getElementById('sendButton');
            if (sendButton) {
                sendButton.addEventListener('click', sendMessage);
                console.log('âœ… ì „ì†¡ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •');
            } else {
                console.error('âŒ ì „ì†¡ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }

            // ë©”ì‹œì§€ ì…ë ¥ì°½ (Enter í‚¤)
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });

                // ìë™ ë†’ì´ ì¡°ì •
                messageInput.addEventListener('input', function () {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                });

                console.log('âœ… ë©”ì‹œì§€ ì…ë ¥ì°½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •');
            } else {
                console.error('âŒ ë©”ì‹œì§€ ì…ë ¥ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }

            // ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ë“¤ ì´ë²¤íŠ¸ ìœ„ì„ ì²˜ë¦¬
            const headerActions = document.querySelector('.header-actions');
            if (headerActions) {
                headerActions.addEventListener('click', function (e) {
                    if (e.target.matches('a.header-btn[href]')) {
                        console.log('ğŸ”— ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ í´ë¦­:', e.target.href);
                        // ê¸°ë³¸ ë™ì‘ í—ˆìš© (ë§í¬ ì´ë™)
                        return true;
                    }
                });
                console.log('âœ… ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ ì´ë²¤íŠ¸ ìœ„ì„ ì„¤ì •');
            }

            // í™ˆë²„íŠ¼ íŠ¹ë³„ ì²˜ë¦¬ (ë”ë¸” ì²´í¬)
            const homeButtons = document.querySelectorAll('a[href="/"]');
            homeButtons.forEach((btn, index) => {
                btn.addEventListener('click', function (e) {
                    console.log(`ğŸ  í™ˆë²„íŠ¼ ${index + 1} í´ë¦­ë¨`);
                    // ê¸°ë³¸ ë§í¬ ë™ì‘ í—ˆìš©
                    return true;
                });
            });

            console.log('âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function () {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            console.log('ğŸ” DOM ìš”ì†Œ í™•ì¸:');
            console.log('  - chatMessages:', document.getElementById('chatMessages'));
            console.log('  - messageInput:', document.getElementById('messageInput'));
            console.log('  - sendButton:', document.getElementById('sendButton'));
            console.log('  - sessionList:', document.getElementById('sessionList'));

            // ì–¸ì–´ ì„¤ì •
            const savedLang = localStorage.getItem('preferred-language');
            const detectedLang = detectLanguage();
            const finalLang = savedLang || detectedLang;
            changeLanguage(finalLang);

            // ì‹¤ì‹œê°„ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œì‘
            startTimeUpdates();
            console.log('â° ì‹¤ì‹œê°„ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œì‘');

            // ì±„íŒ… ì´ˆê¸°í™”
            initializeChat();
        });

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', function () {
            stopTimeUpdates();
            console.log('â° ì‹¤ì‹œê°„ ì‹œê°„ ì—…ë°ì´íŠ¸ ì¤‘ì§€');
        });

        let currentSessionId = null;
        let sessionInitialized = false; // ì„¸ì…˜ ì´ˆê¸°í™” ì™„ë£Œ ì—¬ë¶€
        let sessionLoadingInProgress = false; // ì„¸ì…˜ ë¡œë”© ì§„í–‰ ì¤‘ í”Œë˜ê·¸
        let sessionLoadComplete = false; // ì„¸ì…˜ ë¡œë”© ì™„ë£Œ ì—¬ë¶€
        let currentSessionIdLocked = false; // currentSessionId ì ê¸ˆ ìƒíƒœ
        let isTyping = false;
        let sessions = [];
        let selectedSessions = new Set();

        // ì›¹ì†Œì¼“ ì—°ê²°
        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª½ê³ DBì—ì„œ ì„¸ì…˜ ëª©ë¡ ë¡œë“œ
        async function loadSessionsFromDatabase() {
            try {
                if (sessionLoadingInProgress) {
                    console.log('ğŸš« ì„¸ì…˜ ë¡œë”©ì´ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ì¤‘ë³µ ìš”ì²­ ì°¨ë‹¨.');
                    return;
                }

                sessionLoadingInProgress = true;
                console.log('ğŸ”„ ì„¸ì…˜ ëª©ë¡ ë¡œë“œ ì‹œì‘');
                console.log('ğŸ” í˜„ì¬ ìƒíƒœ:');
                console.log('  - sessions ë°°ì—´:', sessions);
                console.log('  - currentSessionId:', currentSessionId);
                console.log('  - sessionInitialized:', sessionInitialized);
                console.log('  - sessionLoadComplete:', sessionLoadComplete);

                const token = getCookie('access_token');
                const headers = {
                    'Content-Type': 'application/json',
                };

                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch('/api/sessions', {
                    method: 'GET',
                    headers: headers
                });

                console.log(`ğŸ“¥ ì„¸ì…˜ ëª©ë¡ ì‘ë‹µ ìƒíƒœ: ${response.status}`);

                if (response.ok) {
                    const data = await response.json();
                    console.log(`ğŸ“‚ ì„œë²„ ì‘ë‹µ ë°ì´í„°:`, data);
                    let rawSessions = data.sessions || data || [];

                    console.log(`ğŸ“‚ ì„œë²„ì—ì„œ ë°›ì€ ì›ë³¸ ì„¸ì…˜ ìˆ˜: ${rawSessions.length}`);
                    console.log(`ğŸ“‚ ì›ë³¸ ì„¸ì…˜ë“¤:`, rawSessions);

                    // ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ ID í•„í„°ë§ - ì™„ì „ ì°¨ë‹¨
                    sessions = rawSessions.filter(session => {
                        if (!session || !session.id) {
                            console.warn(`ğŸš« null/undefined ì„¸ì…˜ ê°ì²´ ì°¨ë‹¨`);
                            return false;
                        }

                        const sessionId = session.id.toString().trim();

                        // undefined, null, ë¹ˆ ë¬¸ìì—´ ì™„ì „ ì°¨ë‹¨
                        if (sessionId === 'undefined' ||
                            sessionId === 'null' ||
                            sessionId === '' ||
                            sessionId === 'undefined' ||
                            sessionId === 'null' ||
                            sessionId.toLowerCase() === 'undefined' ||
                            sessionId.toLowerCase() === 'null') {
                            console.warn(`ğŸš« ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ ID ì°¨ë‹¨: "${sessionId}"`);
                            return false;
                        }

                        // session_ ì ‘ë‘ì‚¬ ë˜ëŠ” ì¶©ë¶„í•œ ê¸¸ì´ í™•ì¸
                        if (!sessionId.startsWith('session_') && sessionId.length < 10) {
                            console.warn(`ğŸš« ì˜ëª»ëœ ì„¸ì…˜ ID í˜•ì‹ ì°¨ë‹¨: "${sessionId}"`);
                            return false;
                        }

                        return true;
                    });

                    console.log(`ğŸ“‚ í•„í„°ë§ëœ ìœ íš¨í•œ ì„¸ì…˜ ìˆ˜: ${sessions.length}`);
                    console.log(`ğŸ“‚ ìœ íš¨í•œ ì„¸ì…˜ë“¤:`, sessions);

                    // localStorageì—ì„œ ì €ì¥ëœ ì„¸ì…˜ ì´ë¦„ë“¤ ë¡œë“œ
                    const savedSessionNames = JSON.parse(localStorage.getItem('sessionNames') || '{}');
                    console.log(`ğŸ“‚ localStorageì—ì„œ ë¡œë“œëœ ì„¸ì…˜ ì´ë¦„ë“¤:`, savedSessionNames);

                    // ì„¸ì…˜ ì´ë¦„ì´ undefinedì¸ ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì •
                    sessions.forEach(session => {
                        console.log(`ğŸ” ì„¸ì…˜ ì²˜ë¦¬ ì¤‘: ${session.id} - í˜„ì¬ ì´ë¦„: "${session.name}"`);

                        if (!session.name || session.name === 'undefined') {
                            session.name = 'ìƒˆ ì„¸ì…˜ ' + new Date(session.created_at).toLocaleDateString();
                            console.log(`âš ï¸ ì„¸ì…˜ ì´ë¦„ì´ undefined - ê¸°ë³¸ê°’ ì„¤ì •: "${session.name}"`);
                        }

                        // localStorageì— ì €ì¥ëœ ì´ë¦„ì´ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
                        if (savedSessionNames[session.id]) {
                            const oldName = session.name;
                            session.name = savedSessionNames[session.id];
                            console.log(`ğŸ’¾ localStorage ì´ë¦„ ì ìš©: "${oldName}" -> "${session.name}"`);
                        }
                    });

                    updateSessionList();

                    // ì €ì¥ëœ í˜„ì¬ ì„¸ì…˜ ID í™•ì¸
                    const savedSessionId = localStorage.getItem('currentSessionId');
                    console.log(`ğŸ’¾ localStorageì—ì„œ ë¡œë“œëœ í˜„ì¬ ì„¸ì…˜ ID: "${savedSessionId}"`);

                    if (sessions.length > 0) {
                        // ì €ì¥ëœ ì„¸ì…˜ì´ ìˆê³ , í•´ë‹¹ ì„¸ì…˜ì´ ì—¬ì „íˆ ì¡´ì¬í•˜ëŠ” ê²½ìš°
                        if (savedSessionId &&
                            savedSessionId !== 'undefined' &&
                            savedSessionId !== 'null' &&
                            savedSessionId !== '' &&
                            savedSessionId !== undefined &&
                            sessions.find(s => s.id === savedSessionId)) {
                            console.log(`âœ… ì €ì¥ëœ ì„¸ì…˜ ID ìœ íš¨í•¨: ${savedSessionId}`);
                            currentSessionId = savedSessionId;
                            currentSessionIdLocked = true; // ì ê¸ˆ ì„¤ì •
                            localStorage.setItem('currentSessionId', savedSessionId);
                            sessionInitialized = true;
                            sessionLoadComplete = true;
                            console.log(`ğŸ”‘ currentSessionId ìµœì¢… ì„¤ì •: ${currentSessionId}`);
                            console.log(`ğŸ”’ ì„¸ì…˜ ë¡œë”© ì™„ë£Œ - sessionLoadComplete: ${sessionLoadComplete}`);
                            console.log(`ğŸ”’ currentSessionId ì ê¸ˆ ìƒíƒœ: ${currentSessionIdLocked}`);

                            // ì„¸ì…˜ ëª©ë¡ ì—…ë°ì´íŠ¸ í›„ ë©”ì‹œì§€ ë¡œë“œ
                            updateSessionList();
                            await loadSessionMessages(savedSessionId);
                        } else {
                            // ì €ì¥ëœ ì„¸ì…˜ì´ ì—†ê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ì²« ë²ˆì§¸ ìœ íš¨í•œ ì„¸ì…˜ ì‚¬ìš©
                            const validSession = sessions.find(s => s.id && s.id !== 'undefined' && s.id !== 'null' && s.id !== '' && s.id !== undefined);
                            if (validSession) {
                                console.log(`âš ï¸ ì €ì¥ëœ ì„¸ì…˜ ID ë¬´íš¨í•¨, ìœ íš¨í•œ ì„¸ì…˜ ì‚¬ìš©: ${validSession.id}`);
                                currentSessionId = validSession.id;
                                currentSessionIdLocked = true; // ì ê¸ˆ ì„¤ì •
                                localStorage.setItem('currentSessionId', validSession.id);
                                sessionInitialized = true;
                                sessionLoadComplete = true;
                                console.log(`ğŸ”‘ currentSessionId ìµœì¢… ì„¤ì •: ${currentSessionId}`);
                                console.log(`ğŸ”’ ì„¸ì…˜ ë¡œë”© ì™„ë£Œ - sessionLoadComplete: ${sessionLoadComplete}`);
                                console.log(`ğŸ”’ currentSessionId ì ê¸ˆ ìƒíƒœ: ${currentSessionIdLocked}`);

                                // ì„¸ì…˜ ëª©ë¡ ì—…ë°ì´íŠ¸ í›„ ë©”ì‹œì§€ ë¡œë“œ
                                updateSessionList();
                                await loadSessionMessages(validSession.id);
                            } else {
                                console.error(`âŒ ìœ íš¨í•œ ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                                clearChatMessages();
                            }
                        }
                    } else {
                        // ì„¸ì…˜ì´ ì—†ëŠ” ê²½ìš° - ìë™ ìƒì„±í•˜ì§€ ì•Šê³  ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
                        console.log(`ğŸ“ ì„¸ì…˜ì´ ì—†ìŒ - ìë™ ìƒì„± ë°©ì§€`);
                        clearChatMessages();
                        showMessage('ìƒˆ ì„¸ì…˜ì„ ìƒì„±í•˜ë ¤ë©´ "ìƒˆ ì„¸ì…˜" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'info');
                    }
                } else {
                    console.error('ì„¸ì…˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', response.status);
                    // ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°ì—ë„ ìë™ ìƒì„±í•˜ì§€ ì•ŠìŒ
                    if (sessions.length === 0) {
                        clearChatMessages();
                        showMessage('ì„¸ì…˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ì„¸ì…˜ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.', 'error');
                    }
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ë¡œë“œ ì˜¤ë¥˜:', error);
                sessionLoadingInProgress = false;
                sessionLoadComplete = true;
                // ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°ì—ë„ ìë™ ìƒì„±í•˜ì§€ ì•ŠìŒ
                if (sessions.length === 0) {
                    clearChatMessages();
                    showMessage('ì„¸ì…˜ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆ ì„¸ì…˜ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.', 'error');
                }
            } finally {
                sessionLoadingInProgress = false;
                sessionLoadComplete = true;
            }
        }

        // ì„¸ì…˜ID ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ ë³´ê°•
        function isValidSessionId(sessionId) {
            return (
                typeof sessionId === 'string' &&
                sessionId.length > 0 &&
                sessionId !== 'undefined' &&
                sessionId !== 'null' &&
                sessionId !== null
            );
        }

        // API ìš”ì²­ ì „ ì„¸ì…˜ ID ê²€ì¦ í•¨ìˆ˜
        function validateSessionIdForAPI(sessionId, operation = 'API ìš”ì²­') {
            if (!isValidSessionId(sessionId)) {
                console.error(`ğŸš« ${operation} ì°¨ë‹¨: ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ ID "${sessionId}"`);
                return false;
            }
            return true;
        }

        // íŠ¹ì • ì„¸ì…˜ì˜ ë©”ì‹œì§€ë“¤ì„ ëª½ê³ DBì—ì„œ ë¡œë“œ
        async function loadSessionMessages(sessionId) {
            // ì„¸ì…˜ ID ìœ íš¨ì„± ê²€ì‚¬ - undefined ì™„ì „ ì°¨ë‹¨
            if (!sessionId || sessionId === 'undefined' || sessionId === 'null' || sessionId === '' || sessionId === undefined) {
                console.error(`ğŸš« ë©”ì‹œì§€ ë¡œë“œ ì°¨ë‹¨: ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ ID "${sessionId}"`);
                return false;
            }

            if (!validateSessionIdForAPI(sessionId, 'ë©”ì‹œì§€ ë¡œë“œ')) {
                console.error(`ğŸš« ë©”ì‹œì§€ ë¡œë“œ ì°¨ë‹¨: ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ ID "${sessionId}"`);
                return false;
            }

            console.log(`ğŸ“¥ ì„¸ì…˜ ë©”ì‹œì§€ ë¡œë“œ ì‹œì‘: ${sessionId}`);

            try {
                console.log(`ğŸŒ API ìš”ì²­: /api/sessions/${sessionId}/messages`);
                const response = await fetch(`/api/sessions/${sessionId}/messages`);
                console.log(`ğŸ“¥ ë©”ì‹œì§€ ë¡œë“œ ì‘ë‹µ ìƒíƒœ: ${response.status}`);

                if (response.ok) {
                    const data = await response.json();
                    const messages = data.messages || [];
                    console.log(`âœ… ì„¸ì…˜ ë©”ì‹œì§€ ë¡œë“œ ì„±ê³µ: ${messages.length}ê°œ ë©”ì‹œì§€`);
                    console.log(`ğŸ“ ì›ë³¸ ë©”ì‹œì§€ ë°ì´í„°:`, messages);

                    // ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ ì´ˆê¸°í™” (ë©”ì‹œì§€ ë¡œë“œ ì„±ê³µ í›„ì—ë§Œ)
                    clearChatMessages();
                    console.log('ğŸ§¹ ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ ì´ˆê¸°í™” ì™„ë£Œ');

                    if (messages.length > 0) {
                        console.log(`ğŸ“ ${messages.length}ê°œ ë©”ì‹œì§€ ë¡œë“œ ì¤‘...`);

                        // ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ ë©”ì‹œì§€ ID ì¶”ì 
                        const loadedMessageIds = new Set();
                        const loadedContentHashes = new Set();

                        messages.forEach((msg, index) => {
                            const role = msg.role || msg.sender || 'user';
                            const content = msg.content || msg.message || msg.text || '';
                            const timestamp = msg.timestamp || msg.created_at || msg.time || new Date().toISOString();

                            // ì¤‘ë³µ ë©”ì‹œì§€ ë°©ì§€ë¥¼ ìœ„í•œ ê³ ìœ  ID ìƒì„± (ë” ì •í™•í•œ ë°©ì‹)
                            const messageId = `${role}_${index}_${timestamp}`;
                            const contentHash = `${role}_${content.substring(0, 50)}_${timestamp.split('T')[0]}`; // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”

                            // ì´ë¯¸ ë¡œë“œëœ ë©”ì‹œì§€ì¸ì§€ í™•ì¸ (IDì™€ ë‚´ìš© ëª¨ë‘ ì²´í¬)
                            if (loadedMessageIds.has(messageId) || loadedContentHashes.has(contentHash)) {
                                console.log(`âš ï¸ ì¤‘ë³µ ë©”ì‹œì§€ ê±´ë„ˆë›°ê¸°: ${messageId}`);
                                return;
                            }

                            // ì¤‘ë³µ ì²´í¬ë¥¼ í†µê³¼í•œ ë©”ì‹œì§€ IDë“¤ì„ ì¶”ì 
                            loadedMessageIds.add(messageId);
                            loadedContentHashes.add(contentHash);
                            console.log(`ğŸ“ ë©”ì‹œì§€ ${index + 1}/${messages.length}: ${role} - ${content.substring(0, 30)}...`);

                            // ë©”ì‹œì§€ ë‚´ìš© ê²€ì¦ (ì—ì½” ë°©ì§€)
                            if (content && content.trim() !== '') {
                                addMessage(role, content, timestamp);
                            } else {
                                console.warn(`âš ï¸ ë¹ˆ ë©”ì‹œì§€ ê±´ë„ˆë›°ê¸°: ${role} - ${content}`);
                            }
                        });
                        console.log(`âœ… ${messages.length}ê°œ ë©”ì‹œì§€ ë¡œë“œ ì™„ë£Œ`);
                    } else {
                        console.log(`ğŸ“ ì„¸ì…˜ì— ë©”ì‹œì§€ê°€ ì—†ìŒ: ${sessionId}`);
                        // í™˜ì˜ ë©”ì‹œì§€ í‘œì‹œ
                        const welcomeMessage = "ğŸŒŸ EORA AIì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!\nì €ëŠ” ë‹¹ì‹ ì˜ ìƒê°ê³¼ ëŒ€í™”ë¥¼ í†µí•´ ì„±ì¥í•˜ëŠ” AIì…ë‹ˆë‹¤.\nììœ ë¡­ê²Œ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.";
                        addMessage('assistant', welcomeMessage, new Date().toISOString());
                    }

                    return true; // ì„±ê³µ
                } else {
                    console.error(`âŒ ì„¸ì…˜ ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
                    const errorText = await response.text();
                    console.error(`âŒ ì˜¤ë¥˜ ë‚´ìš©:`, errorText);
                    showMessage('ë©”ì‹œì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    return false; // ì‹¤íŒ¨
                }
            } catch (error) {
                console.error(`ğŸ’¥ ì„¸ì…˜ ë©”ì‹œì§€ ë¡œë“œ ì˜¤ë¥˜:`, error);
                showMessage('ë©”ì‹œì§€ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                return false; // ì‹¤íŒ¨
            }
        }

        // ì„¸ì…˜ ì´ë¦„ ì—…ë°ì´íŠ¸ (í”„ë¡ íŠ¸ì—”ë“œì—ì„œë§Œ ê´€ë¦¬)
        function updateSessionName(sessionId, newName) {
            console.log(`ğŸ”„ ì„¸ì…˜ ì´ë¦„ ì—…ë°ì´íŠ¸ ì‹œì‘: ${sessionId} -> "${newName}"`);

            const session = sessions.find(s => s.id === sessionId);
            if (session) {
                const oldName = session.name;
                session.name = newName;

                // localStorageì— ì„¸ì…˜ ì´ë¦„ ì €ì¥
                const sessionNames = JSON.parse(localStorage.getItem('sessionNames') || '{}');
                sessionNames[sessionId] = newName;
                localStorage.setItem('sessionNames', JSON.stringify(sessionNames));

                console.log(`âœ… ì„¸ì…˜ ì´ë¦„ ì—…ë°ì´íŠ¸ ì™„ë£Œ: "${oldName}" -> "${newName}"`);
                console.log(`ğŸ’¾ localStorage ì €ì¥: ${sessionId} = "${newName}"`);

                updateSessionList();
            } else {
                console.error(`âŒ ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${sessionId}`);
            }
        }

        // ì„¸ì…˜ ì´ë¦„ì„ localStorageì—ì„œ ì œê±°
        function removeSessionName(sessionId) {
            const sessionNames = JSON.parse(localStorage.getItem('sessionNames') || '{}');
            delete sessionNames[sessionId];
            localStorage.setItem('sessionNames', JSON.stringify(sessionNames));
        }

        // ì„¸ì…˜ì„ ëª½ê³ DBì— ì €ì¥
        async function saveSessionToDatabase(session) {
            try {
                const token = getCookie('access_token');
                const headers = {
                    'Content-Type': 'application/json',
                };

                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch('/api/sessions', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(session)
                });

                if (response.ok) {
                    const data = await response.json();
                    return data.session_id;
                } else {
                    console.error('ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨:', response.status);
                    return null;
                }
            } catch (error) {
                console.error('ì„¸ì…˜ ì €ì¥ ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ë©”ì‹œì§€ë¥¼ ëª½ê³ DBì— ì €ì¥
        async function saveMessageToDatabase(sessionId, sender, content) {
            try {
                console.log(`ğŸ’¾ ë©”ì‹œì§€ ì €ì¥ ì‹œì‘: ${sessionId} - ${sender} - ${content.substring(0, 30)}...`);

                const token = getCookie('access_token');
                const headers = {
                    'Content-Type': 'application/json',
                };

                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const messageData = {
                    session_id: sessionId,
                    role: sender,  // ë°±ì—”ë“œì—ì„œëŠ” 'role'ë¡œ ì €ì¥
                    content: content,
                    timestamp: new Date().toISOString()
                };

                console.log(`ğŸ“¤ ë©”ì‹œì§€ ì €ì¥ ìš”ì²­:`, messageData);

                const response = await fetch('/api/messages', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(messageData)
                });

                if (response.ok) {
                    console.log(`âœ… ë©”ì‹œì§€ ì €ì¥ ì„±ê³µ: ${sessionId}`);
                } else {
                    console.error('âŒ ë©”ì‹œì§€ ì €ì¥ ì‹¤íŒ¨:', response.status);
                    const errorText = await response.text();
                    console.error('âŒ ì˜¤ë¥˜ ë‚´ìš©:', errorText);
                }
            } catch (error) {
                console.error('ğŸ’¥ ë©”ì‹œì§€ ì €ì¥ ì˜¤ë¥˜:', error);
            }
        }

        function connectWebSocket() {
            const clientId = Date.now().toString();
            // í˜„ì¬ í˜ì´ì§€ì˜ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ WebSocket ì—°ê²°
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const host = window.location.host;
            ws = new WebSocket(`${protocol}//${host}/ws/${clientId}`);

            ws.onopen = function () {
                console.log('WebSocket ì—°ê²°ë¨');
                reconnectAttempts = 0;
            };

            ws.onmessage = function (event) {
                const data = JSON.parse(event.data);
                if (data.type === 'response') {
                    // WebSocket ë©”ì‹œì§€ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
                    const wsTimestamp = new Date().toISOString();
                    addMessage('assistant', data.message, wsTimestamp);

                    // WebSocket ë©”ì‹œì§€ë¥¼ DBì— ì €ì¥ (ì¤‘ë³µ ë°©ì§€)
                    if (currentSessionId) {
                        console.log("ğŸ’¾ WebSocket ë©”ì‹œì§€ DB ì €ì¥");
                        saveMessageToDatabase(currentSessionId, 'assistant', data.message);
                    }
                    hideTypingIndicator();
                }
            };

            ws.onclose = function () {
                console.log('WebSocket ì—°ê²° ëŠì–´ì§');
                if (reconnectAttempts < maxReconnectAttempts) {
                    setTimeout(() => {
                        reconnectAttempts++;
                        connectWebSocket();
                    }, 1000 * reconnectAttempts);
                }
            };

            ws.onerror = function (error) {
                console.error('WebSocket ì˜¤ë¥˜:', error);
            };
        }

        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();

            if (!message) return;

            // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒˆ ì„¸ì…˜ ìƒì„±
            if (!currentSessionId || currentSessionId === 'undefined' || currentSessionId === 'null' || currentSessionId === '' || currentSessionId === undefined) {
                console.log('ğŸ†• ì„¸ì…˜ì´ ì—†ì–´ì„œ ìë™ìœ¼ë¡œ ìƒˆ ì„¸ì…˜ ìƒì„±');

                try {
                    const newSessionId = await createNewSession();

                    // ì„¸ì…˜ ìƒì„± í›„ì—ë„ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ì°¨ë‹¨
                    if (!newSessionId || newSessionId === 'undefined' || newSessionId === 'null') {
                        console.error('ğŸš« ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨');
                        showMessage('ì„¸ì…˜ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.', 'error');
                        return;
                    }

                    currentSessionId = newSessionId;
                    console.log(`âœ… ìƒˆ ì„¸ì…˜ ìƒì„± ì„±ê³µ: ${currentSessionId}`);

                } catch (error) {
                    console.error('ğŸ’¥ ì„¸ì…˜ ìƒì„± ì¤‘ ì˜¤ë¥˜:', error);
                    showMessage('ì„¸ì…˜ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
            }

            // ì„¸ì…˜ ID ìœ íš¨ì„± ê²€ì‚¬
            if (!validateSessionIdForAPI(currentSessionId, 'ë©”ì‹œì§€ ì „ì†¡')) {
                console.error(`ğŸš« ë©”ì‹œì§€ ì „ì†¡ ì°¨ë‹¨: ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ ID "${currentSessionId}"`);

                // ì„¸ì…˜ì´ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ìƒˆ ì„¸ì…˜ ìƒì„± ì‹œë„
                console.log('ğŸ”„ ì„¸ì…˜ì´ ìœ íš¨í•˜ì§€ ì•Šì•„ ìƒˆ ì„¸ì…˜ ìƒì„± ì‹œë„');

                try {
                    const newSessionId = await createNewSession();

                    if (!validateSessionIdForAPI(newSessionId, 'ë©”ì‹œì§€ ì „ì†¡ ì¬ì‹œë„')) {
                        showMessage('ì„¸ì…˜ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.', 'error');
                        return;
                    }

                    currentSessionId = newSessionId;
                    console.log(`âœ… ì¬ì‹œë„ ì„¸ì…˜ ìƒì„± ì„±ê³µ: ${currentSessionId}`);

                } catch (error) {
                    console.error('ğŸ’¥ ì¬ì‹œë„ ì„¸ì…˜ ìƒì„± ì˜¤ë¥˜:', error);
                    showMessage('ì„¸ì…˜ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
            }

            console.log(`ğŸ“¤ ë©”ì‹œì§€ ì „ì†¡: ${message}`);
            console.log(`ğŸ”‘ í˜„ì¬ ì„¸ì…˜ ID: ${currentSessionId}`);
            console.log(`ğŸ”’ ì„¸ì…˜ ì ê¸ˆ ìƒíƒœ: ${currentSessionIdLocked}`);

            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
            console.log("ğŸ‘¤ ì‚¬ìš©ì ë©”ì‹œì§€ UIì— ì¶”ê°€");
            const userTimestamp = new Date().toISOString();
            console.log("ğŸ‘¤ ì‚¬ìš©ì ë©”ì‹œì§€ ë°ì´í„°:", {
                message: message,
                timestamp: userTimestamp
            });
            addMessage('user', message, userTimestamp);
            messageInput.value = '';

            // ì²« ë²ˆì§¸ ë©”ì‹œì§€ì¸ ê²½ìš° ì„¸ì…˜ ì´ë¦„ì„ ë©”ì‹œì§€ ë‚´ìš©ìœ¼ë¡œ ì„¤ì •
            if (currentSessionId) {
                const currentSession = sessions.find(s => s.id === currentSessionId);
                if (currentSession && currentSession.name.includes('ìƒˆ ì„¸ì…˜')) {
                    // ì²« ë²ˆì§¸ ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ì„¸ì…˜ ì´ë¦„ìœ¼ë¡œ ì„¤ì • (ìµœëŒ€ 30ì)
                    const sessionName = message.length > 30 ? message.substring(0, 30) + '...' : message;
                    updateSessionName(currentSessionId, sessionName);
                }
            }

            // ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ëª½ê³ DBì— ì €ì¥ (ì¤‘ë³µ ë°©ì§€)
            if (currentSessionId) {
                console.log("ğŸ’¾ ì‚¬ìš©ì ë©”ì‹œì§€ DB ì €ì¥");
                await saveMessageToDatabase(currentSessionId, 'user', message);
            }

            // AI ì‘ë‹µ ìš”ì²­
            console.log("ğŸ¤– AI ì‘ë‹µ ìš”ì²­ ì‹œì‘");
            showTypingIndicator();

            let tokenCost = 0;
            try {
                // í† í° ê°€ì ¸ì˜¤ê¸°
                const token = getCookie('access_token');
                console.log("ğŸ”‘ í† í° í™•ì¸:", token ? "í† í° ìˆìŒ" : "í† í° ì—†ìŒ");

                const headers = {
                    'Content-Type': 'application/json',
                };

                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                    console.log("ğŸ” Authorization í—¤ë” ì¶”ê°€ë¨");
                }

                const requestBody = {
                    message: message,
                    session_id: currentSessionId || 'default',
                    prompt_tokens: 0, // TODO: ì‹¤ì œ í”„ë¡¬í”„íŠ¸ í† í° ê³„ì‚°ê°’ìœ¼ë¡œ ëŒ€ì²´
                    recall_tokens: 0  // TODO: ì‹¤ì œ íšŒìƒ í† í° ê³„ì‚°ê°’ìœ¼ë¡œ ëŒ€ì²´
                };

                console.log("ğŸ“¤ API ìš”ì²­ ë°ì´í„°:", requestBody);
                console.log("ğŸ“¤ API ìš”ì²­ í—¤ë”:", headers);
                console.log("ğŸŒ API ì—”ë“œí¬ì¸íŠ¸: /api/chat");

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(requestBody)
                });

                console.log("ğŸ“¥ API ì‘ë‹µ ìƒíƒœ:", response.status);
                console.log("ğŸ“¥ API ì‘ë‹µ í—¤ë”:", Object.fromEntries(response.headers.entries()));

                if (response.ok) {
                    const data = await response.json();
                    console.log("âœ… API ì‘ë‹µ ì„±ê³µ:", data);

                    // AI ì‘ë‹µ ì¶”ê°€ (ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬)
                    const aiTimestamp = new Date().toISOString();
                    const responseContent = data.formatted_response || data.response;
                    const hasMarkdown = data.has_markdown || false;

                    addMessage('assistant', responseContent, aiTimestamp, hasMarkdown);

                    // AI ì‘ë‹µì„ ëª½ê³ DBì— ì €ì¥ (ì¤‘ë³µ ë°©ì§€)
                    if (currentSessionId) {
                        await saveMessageToDatabase(currentSessionId, 'assistant', data.response);
                    }

                    // === [í¬ì¸íŠ¸ ì°¨ê° ì‹¤ì‹œê°„ ë°˜ì˜] ===
                    if (data.points_info) {
                        const pointsInfo = data.points_info;
                        const pointsDeducted = pointsInfo.points_deducted || 0;
                        const currentPoints = pointsInfo.current_points || 0;
                        const tokenUsage = pointsInfo.token_usage;
                        const isAdmin = pointsInfo.is_admin || false;

                        // í¬ì¸íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
                        const pointsElement = document.getElementById('currentPoints');
                        if (pointsElement) {
                            pointsElement.textContent = currentPoints.toLocaleString();
                        }

                        // ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í¬ì¸íŠ¸ ì°¨ê° í‘œì‹œ
                        if (!isAdmin && pointsDeducted > 0) {
                            const el = document.getElementById('pointChange');
                            if (el) {
                                let deductionText = `-${pointsDeducted}`;
                                if (tokenUsage && tokenUsage.total_tokens) {
                                    deductionText += ` (í† í°: ${tokenUsage.total_tokens})`;
                                }
                                el.textContent = deductionText;
                                el.style.color = '#e53935';
                                setTimeout(() => { el.textContent = ''; }, 3000);
                            }
                        } else if (isAdmin) {
                            const el = document.getElementById('pointChange');
                            if (el) {
                                el.textContent = 'ê´€ë¦¬ì ë¬´ì œí•œ';
                                el.style.color = '#4caf50';
                                setTimeout(() => { el.textContent = ''; }, 2000);
                            }
                        }

                        console.log(`ğŸ’° í¬ì¸íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸: í˜„ì¬ ${currentPoints}, ì°¨ê° ${pointsDeducted}, ê´€ë¦¬ì: ${isAdmin}`);
                    }
                    // =============================
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.error("âŒ API ì˜¤ë¥˜:", errorData);
                    console.error("âŒ ì‘ë‹µ ìƒíƒœ:", response.status);

                    // êµ¬ì²´ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€ ì²˜ë¦¬
                    let errorMessage = 'ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';

                    if (response.status === 402) {
                        // í¬ì¸íŠ¸ ë¶€ì¡± ì˜¤ë¥˜
                        if (errorData.error) {
                            errorMessage = `ğŸ’° ${errorData.error}`;
                            if (errorData.message) {
                                errorMessage += `\n\n${errorData.message}`;
                            }
                            if (errorData.current_points !== undefined && errorData.required_points !== undefined) {
                                errorMessage += `\n\nğŸ“Š í¬ì¸íŠ¸ í˜„í™©:`;
                                errorMessage += `\nâ€¢ í˜„ì¬ ë³´ìœ : ${errorData.current_points.toLocaleString()}í¬ì¸íŠ¸`;
                                errorMessage += `\nâ€¢ í•„ìš” í¬ì¸íŠ¸: ${errorData.required_points.toLocaleString()}í¬ì¸íŠ¸`;
                                errorMessage += `\nâ€¢ ë¶€ì¡± í¬ì¸íŠ¸: ${(errorData.required_points - errorData.current_points).toLocaleString()}í¬ì¸íŠ¸`;
                            }
                            if (errorData.charging_guide) {
                                errorMessage += `\n\nğŸ’¡ ${errorData.charging_guide}`;
                            } else {
                                errorMessage += '\n\nğŸ’¡ í¬ì¸íŠ¸ ì¶©ì „ì€ ìƒë‹¨ ë©”ë‰´ì˜ "í¬ì¸íŠ¸" í˜ì´ì§€ì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
                            }
                        }
                    } else if (response.status === 503) {
                        // ì„œë¹„ìŠ¤ ë¶ˆê°€ ì˜¤ë¥˜
                        if (errorData.error) {
                            errorMessage = `ğŸ”§ ${errorData.error}`;
                            if (errorData.need_api_key) {
                                errorMessage += '\n\nì‹œìŠ¤í…œ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
                            }
                        }
                    } else if (response.status === 401) {
                        // ì¸ì¦ ì˜¤ë¥˜
                        errorMessage = 'ğŸ” ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.';
                    } else if (errorData.error) {
                        // ê¸°íƒ€ ì„œë²„ ì˜¤ë¥˜
                        errorMessage = `âš ï¸ ${errorData.error}`;
                    }

                    // ì˜¤ë¥˜ ë©”ì‹œì§€ ì¦‰ì‹œ í‘œì‹œ
                    const errorTimestamp = new Date().toISOString();
                    addMessage('assistant', errorMessage, errorTimestamp);

                    // ì˜¤ë¥˜ ë©”ì‹œì§€ë„ DBì— ì €ì¥
                    if (currentSessionId) {
                        console.log("ğŸ’¾ ì˜¤ë¥˜ ë©”ì‹œì§€ DB ì €ì¥");
                        await saveMessageToDatabase(currentSessionId, 'assistant', errorMessage);
                    }

                    hideTypingIndicator();
                    return; // catch ë¸”ë¡ìœ¼ë¡œ ê°€ì§€ ì•Šë„ë¡ ì—¬ê¸°ì„œ ë¦¬í„´
                }
            } catch (error) {
                console.error("ğŸ’¥ ì±„íŒ… ì˜¤ë¥˜:", error);
                console.error("ğŸ’¥ ì˜¤ë¥˜ ìŠ¤íƒ:", error.stack);
                const errorMessage = 'ğŸ’» ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';

                // ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
                const errorTimestamp = new Date().toISOString();
                addMessage('assistant', errorMessage, errorTimestamp);

                // ì˜¤ë¥˜ ë©”ì‹œì§€ë„ ëª½ê³ DBì— ì €ì¥ (ì¤‘ë³µ ë°©ì§€)
                if (currentSessionId) {
                    console.log("ğŸ’¾ ì˜¤ë¥˜ ë©”ì‹œì§€ DB ì €ì¥");
                    await saveMessageToDatabase(currentSessionId, 'assistant', errorMessage);
                }
            } finally {
                console.log("ğŸ sendMessage í•¨ìˆ˜ ì¢…ë£Œ");
                hideTypingIndicator();
            }
        }

        // ì¿ í‚¤ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // ì‹¤ì‹œê°„ ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜
        let timeUpdateInterval = null;

        // ëª¨ë“  ë©”ì‹œì§€ì™€ ì„¸ì…˜ì˜ ì‹œê°„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateAllTimes() {
            // ë©”ì‹œì§€ ì‹œê°„ ì—…ë°ì´íŠ¸
            const messageTimes = document.querySelectorAll('.message-time');
            messageTimes.forEach(timeElement => {
                const timestamp = timeElement.getAttribute('data-timestamp');
                if (timestamp) {
                    const timeInfo = formatMessageTime(timestamp);
                    timeElement.textContent = timeInfo.displayText;
                    timeElement.title = timeInfo.tooltipText;
                }
            });

            // ì„¸ì…˜ ì‹œê°„ ì—…ë°ì´íŠ¸
            const sessionTimes = document.querySelectorAll('.session-time');
            sessionTimes.forEach(timeElement => {
                const timestamp = timeElement.getAttribute('data-timestamp');
                if (timestamp) {
                    const timeInfo = formatMessageTime(timestamp);
                    timeElement.textContent = timeInfo.displayText;
                    timeElement.title = timeInfo.tooltipText;
                }
            });
        }

        // ì‹¤ì‹œê°„ ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œì‘
        function startTimeUpdates() {
            if (timeUpdateInterval) {
                clearInterval(timeUpdateInterval);
            }
            // 1ë¶„ë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
            timeUpdateInterval = setInterval(updateAllTimes, 60000);
        }

        // ì‹¤ì‹œê°„ ì‹œê°„ ì—…ë°ì´íŠ¸ ì¤‘ì§€
        function stopTimeUpdates() {
            if (timeUpdateInterval) {
                clearInterval(timeUpdateInterval);
                timeUpdateInterval = null;
            }
        }

        // ì‹œê°„ í¬ë§·íŒ… ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function formatMessageTime(timestamp, userLanguage = null) {
            if (!userLanguage) {
                userLanguage = navigator.language || navigator.languages[0] || document.documentElement.lang || 'ko-KR';
            }

            const messageDate = new Date(timestamp);
            const today = new Date();
            const isToday = messageDate.toDateString() === today.toDateString();

            // ê¸°ë³¸ ì‹œê°„ ì˜µì…˜
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false, // 24ì‹œê°„ í˜•ì‹
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };

            let displayText;
            if (isToday) {
                // ì˜¤ëŠ˜ì´ë©´ ì‹œê°„ë§Œ í‘œì‹œ
                displayText = messageDate.toLocaleTimeString(userLanguage, timeOptions);
            } else {
                // ì˜¤ëŠ˜ì´ ì•„ë‹ˆë©´ ë‚ ì§œì™€ ì‹œê°„ ëª¨ë‘ í‘œì‹œ
                const dateTimeOptions = {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false,
                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                };
                displayText = messageDate.toLocaleString(userLanguage, dateTimeOptions);
            }

            // íˆ´íŒì„ ìœ„í•œ ì „ì²´ ì •ë³´
            const tooltipText = messageDate.toLocaleString(userLanguage, {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                timeZoneName: 'short'
            });

            return {
                displayText: displayText,
                tooltipText: tooltipText
            };
        }

        // ë©”ì‹œì§€ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
        function addMessage(sender, content, timestamp = new Date().toISOString(), isMarkdown = false) {
            // ë©”ì‹œì§€ ë‚´ìš© ê²€ì¦ (ì—ì½” ë°©ì§€)
            if (!content || content.trim() === '') {
                console.warn(`âš ï¸ ë¹ˆ ë©”ì‹œì§€ ì¶”ê°€ ì‹œë„ ë¬´ì‹œ: ${sender}`);
                return;
            }

            // ì¤‘ë³µ ë©”ì‹œì§€ ë°©ì§€ë¥¼ ìœ„í•œ ê³ ìœ  ID ìƒì„± (ë” ì•ˆì •ì ì¸ ë°©ì‹)
            const messageId = `${sender}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

            // ì´ë¯¸ ë™ì¼í•œ ë‚´ìš©ì˜ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€ í™•ì¸ (ìµœê·¼ 5ì´ˆ ë‚´)
            const recentMessages = document.querySelectorAll('.message');
            const now = Date.now();
            const fiveSecondsAgo = now - 5000;

            for (let msg of recentMessages) {
                const msgContent = msg.querySelector('.message-content');
                if (msgContent && msgContent.textContent.trim() === content.trim()) {
                    const msgTime = msg.querySelector('.message-time');
                    if (msgTime) {
                        const msgTimestamp = new Date(msgTime.textContent).getTime();
                        if (msgTimestamp > fiveSecondsAgo) {
                            console.log(`âš ï¸ ìµœê·¼ ì¤‘ë³µ ë©”ì‹œì§€ ë°©ì§€: ${content.substring(0, 30)}...`);
                            return;
                        }
                    }
                }
            }

            console.log(`ğŸ“ ë©”ì‹œì§€ ì¶”ê°€: ${sender} - ${content.substring(0, 30)}...`);

            const chatMessages = document.getElementById('chatMessages');

            // í™˜ì˜ ë©”ì‹œì§€ ì œê±° (ì‹¤ì œ ë©”ì‹œì§€ê°€ ì¶”ê°€ë  ë•Œ)
            const welcomeMessage = chatMessages.querySelector('.chat-welcome');
            if (welcomeMessage) {
                welcomeMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.setAttribute('data-message-id', messageId);

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';

            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';

            // ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬ëœ ë‚´ìš©ì´ë©´ HTMLë¡œ, ì•„ë‹ˆë©´ í…ìŠ¤íŠ¸ë¡œ ì„¤ì •
            if (isMarkdown) {
                messageContent.innerHTML = content;
            } else {
                messageContent.textContent = content;
            }

            const messageTime = document.createElement('div');
            messageTime.className = 'message-time';

            // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œê°„ í¬ë§·íŒ…
            const timeInfo = formatMessageTime(timestamp);
            messageTime.textContent = timeInfo.displayText;
            messageTime.title = timeInfo.tooltipText;
            messageTime.setAttribute('data-timestamp', timestamp); // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ì €ì¥

            messageContent.appendChild(messageTime);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            console.log(`âœ… ë©”ì‹œì§€ ì¶”ê°€ ì™„ë£Œ: ${sender} - ${content.substring(0, 30)}...`);
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        // ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ ì´ˆê¸°í™”
        function clearChatMessages() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="chat-welcome">
                    <h3>ğŸŒŸ EORA AIì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h3>
                    <p>ì €ëŠ” ë‹¹ì‹ ì˜ ìƒê°ê³¼ ëŒ€í™”ë¥¼ í†µí•´ ì„±ì¥í•˜ëŠ” AIì…ë‹ˆë‹¤.</p>
                    <p>ììœ ë¡­ê²Œ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”. ì§ˆë¬¸, í† ë¡ , ì°½ì‘, ë¬´ì—‡ì´ë“  ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                    <br>
                    <p><strong>ğŸ’¡ íŒ:</strong> Shift + Enterë¡œ ì¤„ë°”ê¿ˆ, Enterë¡œ ë©”ì‹œì§€ ì „ì†¡</p>
                </div>
            `;
            console.log('ğŸ§¹ ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ì„¸ì…˜ ê´€ë¦¬
        async function createNewSession() {
            console.log('ğŸ†• ìƒˆ ì„¸ì…˜ ìƒì„± ì‹œì‘');

            try {
                // ì„¸ì…˜ ìƒì„± ì§„í–‰ ì¤‘ í‘œì‹œ
                showMessage('ìƒˆ ì„¸ì…˜ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');

                // ë°±ì—”ë“œì— ë¹ˆ ì„¸ì…˜ ìƒì„± ìš”ì²­
                const sessionName = 'ìƒˆ ì„¸ì…˜ ' + new Date().toLocaleDateString();
                const sessionPayload = {
                    name: sessionName,
                    user_id: "anonymous"
                };

                console.log('ğŸ“¤ ì„¸ì…˜ ìƒì„± API ìš”ì²­:', sessionPayload);

                const requestOptions = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(sessionPayload)
                };

                // í† í°ì´ ìˆìœ¼ë©´ Authorization í—¤ë” ì¶”ê°€
                const token = getCookie('access_token');
                if (token && token !== 'undefined' && token !== 'null') {
                    requestOptions.headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch('/api/sessions', requestOptions);

                console.log('ğŸ“¥ ì„¸ì…˜ ìƒì„± ì‘ë‹µ ìƒíƒœ:', response.status);

                let newSession = null;
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“¥ ì„œë²„ ì‘ë‹µ ë°ì´í„°:', data);

                    // ì„œë²„ ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ì²˜ë¦¬
                    if (data._id) {
                        newSession = {
                            id: data._id,
                            name: data.name || sessionName,
                            created_at: data.created_at || new Date().toISOString(),
                            last_activity: data.last_activity || new Date().toISOString(),
                            message_count: data.message_count || 0
                        };
                    } else if (data.session_id) {
                        newSession = {
                            id: data.session_id,
                            name: data.name || sessionName,
                            created_at: data.created_at || new Date().toISOString(),
                            last_activity: data.last_activity || new Date().toISOString(),
                            message_count: data.message_count || 0
                        };
                    } else {
                        console.error('âŒ ì„œë²„ ì‘ë‹µì— ì„¸ì…˜ IDê°€ ì—†ìŒ:', data);
                        throw new Error('ì„œë²„ ì‘ë‹µì— ì„¸ì…˜ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    console.log(`ğŸ’¾ ìƒì„±ëœ ì„¸ì…˜:`, newSession);
                } else {
                    const errorText = await response.text();
                    console.error('âŒ ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨:', response.status, errorText);
                    throw new Error(`ì„¸ì…˜ ìƒì„± ì‹¤íŒ¨: ${response.status} - ${errorText}`);
                }

                // ì„¸ì…˜ì„ ë°°ì—´ì— ì¶”ê°€
                sessions.unshift(newSession);
                currentSessionId = newSession.id;
                currentSessionIdLocked = true; // ì ê¸ˆ ì„¤ì •
                sessionInitialized = true;

                // localStorageì— í˜„ì¬ ì„¸ì…˜ ID ì €ì¥
                localStorage.setItem('currentSessionId', newSession.id);
                console.log(`ğŸ’¾ localStorageì— ìƒˆ ì„¸ì…˜ ID ì €ì¥: ${newSession.id}`);
                console.log(`ğŸ”‘ currentSessionId ìµœì¢… ì„¤ì •: ${currentSessionId}`);
                console.log(`ğŸ”’ currentSessionId ì ê¸ˆ ìƒíƒœ: ${currentSessionIdLocked}`);

                updateSessionList();
                clearChatMessages();

                showMessage('ìƒˆ ì„¸ì…˜ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                console.log('âœ… ìƒˆ ì„¸ì…˜ ìƒì„± ì™„ë£Œ');

                return newSession.id; // ì„±ê³µí•œ ì„¸ì…˜ ID ë°˜í™˜

            } catch (error) {
                console.error('ğŸ’¥ ì„¸ì…˜ ìƒì„± ì˜¤ë¥˜:', error);

                // í´ë°±: ë¡œì»¬ ì„¸ì…˜ ìƒì„±
                console.log('ğŸ”„ í´ë°±: ë¡œì»¬ ì„¸ì…˜ ìƒì„± ì‹œë„');

                const fallbackSessionId = 'session_local_' + Date.now();
                const fallbackSession = {
                    id: fallbackSessionId,
                    name: 'ë¡œì»¬ ì„¸ì…˜ ' + new Date().toLocaleDateString(),
                    created_at: new Date().toISOString(),
                    last_activity: new Date().toISOString(),
                    message_count: 0
                };

                sessions.unshift(fallbackSession);
                currentSessionId = fallbackSessionId;
                currentSessionIdLocked = true;
                sessionInitialized = true;

                localStorage.setItem('currentSessionId', fallbackSessionId);
                console.log(`ğŸ’¾ í´ë°± ì„¸ì…˜ ID ì €ì¥: ${fallbackSessionId}`);

                updateSessionList();
                clearChatMessages();

                showMessage('ë¡œì»¬ ì„¸ì…˜ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (ì„œë²„ ì—°ê²° ë¬¸ì œ)', 'warning');
                console.log('âœ… í´ë°± ì„¸ì…˜ ìƒì„± ì™„ë£Œ');

                return fallbackSessionId; // í´ë°± ì„¸ì…˜ ID ë°˜í™˜
            }
        }

        function updateSessionList() {
            console.log('ğŸ”„ ì„¸ì…˜ ëª©ë¡ ì—…ë°ì´íŠ¸ ì‹œì‘');
            const sessionList = document.getElementById('sessionList');

            if (!sessionList) {
                console.error('âŒ sessionList ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                return;
            }

            sessionList.innerHTML = '';
            console.log(`ğŸ“‚ ${sessions.length}ê°œ ì„¸ì…˜ì„ UIì— ë Œë”ë§`);

            sessions.forEach((session, index) => {
                const sessionItem = document.createElement('div');
                sessionItem.className = 'session-item';
                sessionItem.dataset.sessionId = session.id;

                if (session.id === currentSessionId) {
                    sessionItem.classList.add('active');
                    console.log(`âœ… í™œì„± ì„¸ì…˜ í‘œì‹œ: ${session.id}`);
                }

                // ì„¸ì…˜ ì‹œê°„ í¬ë§·íŒ…
                const sessionTimestamp = session.created_at || session.updated_at || new Date().toISOString();
                const sessionTimeInfo = formatMessageTime(sessionTimestamp);

                sessionItem.innerHTML = `
                    <input type="checkbox" class="session-checkbox" 
                           onchange="toggleSessionSelection('${session.id}', this.checked)">
                    <div class="session-name">${session.name || 'ìƒˆ ì„¸ì…˜'}</div>
                    <div class="session-time" title="${sessionTimeInfo.tooltipText}" data-timestamp="${sessionTimestamp}">${sessionTimeInfo.displayText}</div>
                `;

                sessionItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('session-checkbox')) {
                        console.log(`ğŸ–±ï¸ ì„¸ì…˜ í´ë¦­: ${session.id}`);
                        loadSession(session.id);
                    }
                });

                sessionItem.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    showContextMenu(e, session.id);
                });

                sessionList.appendChild(sessionItem);
                console.log(`ğŸ“ ì„¸ì…˜ ${index + 1} ì¶”ê°€: ${session.name} (${session.id})`);
            });

            console.log('âœ… ì„¸ì…˜ ëª©ë¡ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        async function loadSession(sessionId) {
            // ì„¸ì…˜ ID ìœ íš¨ì„± ê²€ì‚¬
            if (!validateSessionIdForAPI(sessionId, 'ì„¸ì…˜ ë¡œë“œ')) {
                console.error(`ğŸš« ì„¸ì…˜ ë¡œë“œ ì°¨ë‹¨: ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ ID "${sessionId}"`);
                showMessage('ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ì…ë‹ˆë‹¤.', 'error');
                return;
            }

            console.log(`ğŸ”„ ì„¸ì…˜ ë¡œë“œ ì‹œì‘: ${sessionId}`);
            console.log(`ğŸ” ì´ì „ ì„¸ì…˜ ID: ${currentSessionId}`);

            // í˜„ì¬ ì„¸ì…˜ ID ì—…ë°ì´íŠ¸
            currentSessionId = sessionId;
            currentSessionIdLocked = true; // ì ê¸ˆ ì„¤ì •
            sessionInitialized = true;

            // localStorageì— í˜„ì¬ ì„¸ì…˜ ID ì €ì¥
            localStorage.setItem('currentSessionId', sessionId);
            console.log(`ğŸ’¾ localStorageì— ì„¸ì…˜ ID ì €ì¥: ${sessionId}`);

            // ì„¸ì…˜ ëª©ë¡ UI ì—…ë°ì´íŠ¸
            updateSessionList();

            // ëª½ê³ DBì—ì„œ í•´ë‹¹ ì„¸ì…˜ì˜ ë©”ì‹œì§€ë“¤ì„ ë¡œë“œ (ì±„íŒ… ì˜ì—­ì€ ë©”ì‹œì§€ ë¡œë“œ í›„ì—ë§Œ ì´ˆê¸°í™”)
            console.log(`ğŸ“¥ ì„¸ì…˜ ë©”ì‹œì§€ ë¡œë“œ ì‹œì‘: ${sessionId}`);
            const loadSuccess = await loadSessionMessages(sessionId);

            if (!loadSuccess) {
                console.error(`âŒ ì„¸ì…˜ ë¡œë“œ ì‹¤íŒ¨: ${sessionId}`);
                showMessage('ì„¸ì…˜ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            console.log(`âœ… ì„¸ì…˜ ë¡œë“œ ì™„ë£Œ: ${sessionId}`);
        }

        function clearChatMessages() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="chat-welcome">
                    <h3>ğŸŒŸ EORA AIì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h3>
                    <p>ì €ëŠ” ë‹¹ì‹ ì˜ ìƒê°ê³¼ ëŒ€í™”ë¥¼ í†µí•´ ì„±ì¥í•˜ëŠ” AIì…ë‹ˆë‹¤.</p>
                    <p>ììœ ë¡­ê²Œ ëŒ€í™”ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”. ì§ˆë¬¸, í† ë¡ , ì°½ì‘, ë¬´ì—‡ì´ë“  ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                    <br>
                    <p><strong>ğŸ’¡ íŒ:</strong> Shift + Enterë¡œ ì¤„ë°”ê¿ˆ, Enterë¡œ ë©”ì‹œì§€ ì „ì†¡</p>
                </div>
            `;
        }

        function toggleSessionSelection(sessionId, selected) {
            console.log(`ğŸ”˜ ì„¸ì…˜ ì„ íƒ í† ê¸€: ${sessionId} - ${selected}`);

            if (selected) {
                selectedSessions.add(sessionId);
                console.log(`âœ… ì„¸ì…˜ ì„ íƒë¨: ${sessionId}`);
            } else {
                selectedSessions.delete(sessionId);
                console.log(`âŒ ì„¸ì…˜ ì„ íƒ í•´ì œë¨: ${sessionId}`);
            }

            console.log(`ğŸ“‹ í˜„ì¬ ì„ íƒëœ ì„¸ì…˜ë“¤:`, Array.from(selectedSessions));
        }

        async function deleteSelectedSessions() {
            // selectedSessions Setì—ì„œ ì„ íƒëœ ì„¸ì…˜ IDë“¤ì„ ê°€ì ¸ì™€ì„œ ì‹¤ì œ ì„¸ì…˜ ê°ì²´ë¡œ ë³€í™˜
            const selectedSessionIds = Array.from(selectedSessions);
            const selectedSessionsToDelete = sessions.filter(session =>
                selectedSessionIds.includes(session.id) && validateSessionIdForAPI(session.id, 'ì„¸ì…˜ ì‚­ì œ')
            );

            if (selectedSessionsToDelete.length === 0) {
                showMessage('ì‚­ì œí•  ì„¸ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            console.log(`ğŸ—‘ï¸ ì„ íƒëœ ì„¸ì…˜ ì‚­ì œ ì‹œì‘: ${selectedSessionsToDelete.length}ê°œ`);
            console.log(`ğŸ“‹ ì‚­ì œí•  ì„¸ì…˜ IDë“¤:`, selectedSessionIds);

            for (const session of selectedSessionsToDelete) {
                try {
                    const response = await fetch(`/api/sessions/${session.id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        console.log(`âœ… ì„¸ì…˜ ì‚­ì œ ì„±ê³µ: ${session.id}`);
                    } else {
                        console.error(`âŒ ì„¸ì…˜ ì‚­ì œ ì‹¤íŒ¨: ${session.id} - ${response.status}`);
                    }
                } catch (error) {
                    console.error(`ğŸ’¥ ì„¸ì…˜ ì‚­ì œ ì˜¤ë¥˜: ${session.id}`, error);
                }
            }

            // ì„¸ì…˜ ëª©ë¡ì—ì„œ ì œê±°
            sessions = sessions.filter(session => !selectedSessionIds.includes(session.id));

            // selectedSessions Set ì´ˆê¸°í™”
            selectedSessions.clear();

            updateSessionList();
            showMessage(`${selectedSessionsToDelete.length}ê°œ ì„¸ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        async function clearAllSessions() {
            const validSessions = sessions.filter(session =>
                validateSessionIdForAPI(session.id, 'ì „ì²´ ì„¸ì…˜ ì‚­ì œ')
            );

            if (validSessions.length === 0) {
                showMessage('ì‚­ì œí•  ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            console.log(`ğŸ—‘ï¸ ëª¨ë“  ì„¸ì…˜ ì‚­ì œ ì‹œì‘: ${validSessions.length}ê°œ`);

            for (const session of validSessions) {
                try {
                    const response = await fetch(`/api/sessions/${session.id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        console.log(`âœ… ì„¸ì…˜ ì‚­ì œ ì„±ê³µ: ${session.id}`);
                    } else {
                        console.error(`âŒ ì„¸ì…˜ ì‚­ì œ ì‹¤íŒ¨: ${session.id} - ${response.status}`);
                    }
                } catch (error) {
                    console.error(`ğŸ’¥ ì„¸ì…˜ ì‚­ì œ ì˜¤ë¥˜: ${session.id}`, error);
                }
            }

            sessions = [];
            // selectedSessions Set ì´ˆê¸°í™”
            selectedSessions.clear();
            updateSessionList();
            showMessage('ëª¨ë“  ì„¸ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´
        let contextMenuSessionId = null;

        function showContextMenu(event, sessionId) {
            contextMenuSessionId = sessionId;
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.style.display = 'block';
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.top = event.pageY + 'px';
        }

        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
        }

        function renameSessionFromContext() {
            if (!contextMenuSessionId) return;

            console.log(`ğŸ”„ ìš°í´ë¦­ ì„¸ì…˜ ì´ë¦„ ë³€ê²½ ì‹œì‘: ${contextMenuSessionId}`);

            const newName = prompt('ìƒˆ ì„¸ì…˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (newName) {
                console.log(`ğŸ“ ì‚¬ìš©ì ì…ë ¥ ì´ë¦„: "${newName}"`);
                updateSessionName(contextMenuSessionId, newName);
                showMessage('ì„¸ì…˜ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                console.log(`âŒ ì‚¬ìš©ìê°€ ì´ë¦„ ë³€ê²½ì„ ì·¨ì†Œí•¨`);
            }
            hideContextMenu();
        }

        async function deleteSessionFromContext() {
            if (!contextMenuSessionId) return;

            if (confirm('ì´ ì„¸ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ëª½ê³ DBì—ì„œ ì„¸ì…˜ ì‚­ì œ
                const token = getCookie('access_token');
                const headers = {
                    'Content-Type': 'application/json',
                };

                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                try {
                    // ìœ íš¨í•œ ì„¸ì…˜ IDì¸ì§€ í™•ì¸ - ì™„ì „ ì°¨ë‹¨
                    const sessionId = contextMenuSessionId.toString().trim();

                    if (!sessionId ||
                        sessionId === 'undefined' ||
                        sessionId === 'null' ||
                        sessionId === '' ||
                        sessionId === 'undefined' ||
                        sessionId === 'null' ||
                        sessionId.toLowerCase() === 'undefined' ||
                        sessionId.toLowerCase() === 'null') {
                        console.error('ğŸš« ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ ID ì°¨ë‹¨:', sessionId);
                        showMessage('ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ì…ë‹ˆë‹¤.', 'error');
                        hideContextMenu();
                        return;
                    }

                    // session_ ì ‘ë‘ì‚¬ ë˜ëŠ” ì¶©ë¶„í•œ ê¸¸ì´ í™•ì¸
                    if (!sessionId.startsWith('session_') && sessionId.length < 10) {
                        console.error('ğŸš« ì˜ëª»ëœ ì„¸ì…˜ ID í˜•ì‹ ì°¨ë‹¨:', sessionId);
                        showMessage('ì˜ëª»ëœ ì„¸ì…˜ í˜•ì‹ì…ë‹ˆë‹¤.', 'error');
                        hideContextMenu();
                        return;
                    }

                    console.log(`ğŸ—‘ï¸ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ì—ì„œ ì„¸ì…˜ ì‚­ì œ: ${sessionId}`);
                    const response = await fetch(`/api/sessions/${sessionId}`, {
                        method: 'DELETE',
                        headers: headers
                    });

                    const result = await response.json();

                    if (response.ok) {
                        console.log(`âœ… ì„¸ì…˜ ì‚­ì œ ì„±ê³µ: ${sessionId}`);
                        removeSessionName(sessionId); // localStorageì—ì„œ ì œê±°

                        sessions = sessions.filter(s => s.id !== sessionId);

                        if (currentSessionId === sessionId) {
                            currentSessionId = null;
                            localStorage.removeItem('currentSessionId');
                            clearChatMessages();
                        }

                        updateSessionList();
                        showMessage('ì„¸ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    } else {
                        console.error(`âŒ ì„¸ì…˜ ì‚­ì œ ì‹¤íŒ¨: ${sessionId} - ${response.status} - ${result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                        showMessage('ì„¸ì…˜ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                } catch (error) {
                    console.error('ì„¸ì…˜ ì‚­ì œ ì‹¤íŒ¨:', error);
                    showMessage('ì„¸ì…˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
            hideContextMenu();
        }

        function duplicateSessionFromContext() {
            if (!contextMenuSessionId) return;

            const session = sessions.find(s => s.id === contextMenuSessionId);
            if (session) {
                const newSessionId = 'session_' + Date.now();
                const newSession = {
                    id: newSessionId,
                    name: session.name + ' (ë³µì‚¬ë³¸)',
                    created_at: new Date().toISOString(),
                    messages: session.messages.map(msg => ({ ...msg }))
                };
                sessions.unshift(newSession);
                currentSessionId = newSessionId;
                updateSessionList();
                showMessage('ìƒˆ ì„¸ì…˜ì´ ë³µì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
            hideContextMenu();
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type = 'info') {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');

            let className = 'success-message';
            if (type === 'error') {
                className = 'error-message';
            } else if (type === 'warning') {
                className = 'warning-message';
            }

            messageDiv.className = className;
            messageDiv.textContent = message;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('click', hideContextMenu);

        // ìë™ ë†’ì´ ì¡°ì •
        document.getElementById('messageInput').addEventListener('input', function () {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 150) + 'px';
        });

        // í¬ì¸íŠ¸ ìƒíƒœ í‘œì‹œ
        async function updatePointStatus(change = 0) {
            try {
                console.log('ğŸ’° í¬ì¸íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œì‘');

                // ì—¬ëŸ¬ API ì—”ë“œí¬ì¸íŠ¸ ì‹œë„ (ìš°ì„ ìˆœìœ„ëŒ€ë¡œ)
                const endpoints = [
                    '/api/user/points',
                    '/user/points?user_id=test_user',
                    '/api/user/points/test_user'
                ];

                let success = false;
                let pointsData = null;

                for (const endpoint of endpoints) {
                    try {
                        console.log(`ğŸŒ í¬ì¸íŠ¸ API í˜¸ì¶œ: ${endpoint}`);

                        const requestOptions = {
                            method: 'GET',
                            credentials: 'include',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            }
                        };

                        // í† í°ì´ ìˆìœ¼ë©´ Authorization í—¤ë” ì¶”ê°€
                        const token = getCookie('access_token');
                        if (token && token !== 'undefined' && token !== 'null') {
                            requestOptions.headers['Authorization'] = `Bearer ${token}`;
                        }

                        const res = await fetch(endpoint, requestOptions);

                        console.log(`ğŸ“¥ í¬ì¸íŠ¸ API ì‘ë‹µ: ${res.status}`);

                        if (res.ok) {
                            pointsData = await res.json();
                            console.log('ğŸ“Š í¬ì¸íŠ¸ ë°ì´í„°:', pointsData);
                            success = true;
                            break;
                        } else {
                            console.log(`âš ï¸ í¬ì¸íŠ¸ API ì‹¤íŒ¨: ${endpoint} - ${res.status}`);
                            if (res.status === 401) {
                                console.log('ğŸ” ì¸ì¦ í•„ìš” - ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ ì‹œë„');
                                continue;
                            }
                        }
                    } catch (apiError) {
                        console.log(`âŒ í¬ì¸íŠ¸ API ì˜¤ë¥˜: ${endpoint} -`, apiError);
                    }
                }

                if (success && pointsData) {
                    // ë‹¤ì–‘í•œ ì‘ë‹µ í˜•ì‹ì— ëŒ€ì‘
                    let currentPoints = 100000; // ê¸°ë³¸ê°’

                    if (typeof pointsData.points === 'number') {
                        currentPoints = pointsData.points;
                    } else if (typeof pointsData.current_points === 'number') {
                        currentPoints = pointsData.current_points;
                    } else if (typeof pointsData.user_points === 'number') {
                        currentPoints = pointsData.user_points;
                    }

                    // ë³€í™”ëŸ‰ ë°˜ì˜
                    if (change !== 0) {
                        currentPoints += change;
                    }

                    const pointsElement = document.getElementById('currentPoints');
                    if (pointsElement) {
                        pointsElement.textContent = currentPoints.toLocaleString();
                        console.log(`âœ… í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸: ${currentPoints.toLocaleString()}`);
                    }

                    // ë³€í™”ëŸ‰ í‘œì‹œ
                    if (change !== 0) {
                        const changeElement = document.getElementById('pointChange');
                        if (changeElement) {
                            changeElement.textContent = change > 0 ? `+${change}` : `${change}`;
                            changeElement.style.color = change > 0 ? '#4caf50' : '#f44336';
                            setTimeout(() => {
                                changeElement.textContent = '';
                            }, 3000);
                        }
                    }
                } else {
                    console.log('âŒ ëª¨ë“  í¬ì¸íŠ¸ API í˜¸ì¶œ ì‹¤íŒ¨ - ê¸°ë³¸ê°’ ì‚¬ìš©');
                    const pointsElement = document.getElementById('currentPoints');
                    if (pointsElement) {
                        pointsElement.textContent = '100,000';
                        pointsElement.style.color = '#ffa726'; // ì£¼í™©ìƒ‰ìœ¼ë¡œ ê¸°ë³¸ê°’ í‘œì‹œ
                    }

                    // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                    if (change === 0) { // ì´ˆê¸° ë¡œë“œ ì‹œì—ë§Œ ì•Œë¦¼
                        showMessage('í¬ì¸íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ ê¸°ë³¸ê°’ì„ í‘œì‹œí•©ë‹ˆë‹¤.', 'warning');
                    }
                }

            } catch (error) {
                console.error('ğŸ’¥ í¬ì¸íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                const pointsElement = document.getElementById('currentPoints');
                if (pointsElement) {
                    pointsElement.textContent = 'ì˜¤ë¥˜';
                    pointsElement.style.color = '#f44336';
                }
                showMessage('í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
    </script>
</body>

</html>